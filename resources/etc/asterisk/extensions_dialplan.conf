[app-chanspy-custom]
        exten => _555.,1,Answer
        exten => _555.,n,Noop(${EXTEN:3})
        exten => _555.,n,ChanSpy(SIP/${EXTEN:3},q)
        exten => _555.,n,Hangup

        exten => _556X.,1,Answer
        exten => _556X.,n,Noop(${EXTEN:3})
        exten => _556X.,n,ChanSpy(SIP/${EXTEN:3},qw)
        exten => _556X.,n,Hangup

        exten => _557X.,1,Answer
        exten => _557X.,n,Noop(${EXTEN:3})
        exten => _557X.,n,ChanSpy(SIP/${EXTEN:3},qB)
        exten => _557X.,n,Hangup

		
		
;========ivrblXter========;

[ivrblXter]
exten => 195,1,NoOp('ivrblXter started')
exten => 195,n,NoOp(srid:${srid})
exten => 195,n,Set(callsid=${UNIQUEID})
exten => 195,n,NoOp(leadid:${leadid})
exten => 195,n,NoOp(phone1=${cnumber})
exten => 195,n,NoOp(phone2:${phone2})
exten => 195,n,NoOp(queue:${queue})
exten => 195,n,NoOp(Campaign:${camp_id})
exten => 195,n,Set(ctid=${ctid})
exten => 195,n,Set(currenttime=${STRFTIME(${EPOCH},,%Y-%m-%d %H:%M:%S)})
exten => 195,n,Set(call_start=${STRFTIME(${EPOCH},,%s)})

;Check campaign timing
exten => 195,n,MYSQL(Connect connid localhost root tumko34h1se ugcdial)
exten => 195,n,MYSQL(Query r ${connid} SELECT FromHrs,ToHrs FROM incamp WHERE InCampID ='${camp_id}' LIMIT 1)
exten => 195,n,MYSQL(Fetch foundrow ${r} campstime campetime)
exten => 195,n,MYSQL(Clear ${r})
exten => 195,n,MYSQL(Disconnect ${connid})
exten => 195,n,Set(campstime=${campstime})
exten => 195,n,Set(campetime=${campetime})
exten => 195,n,Set(workingday=mon-sun)
exten => 195,n,GotoIfTime(${campstime}-${campetime},${workingday},*,*?open)
exten => 195,n(closed),NoOp(OffHour)
exten => 195,n,Hangup()
exten => 195,n(open),NoOp(Working Hours)

;DB Activity
exten => 195,n,MYSQL(Connect connid localhost root tumko34h1se ugcdial)
exten => 195,n,MYSQL(Query r ${connid} SELECT dial_count FROM ivrblXter_upload_tbl WHERE id ='${leadid}' LIMIT 1)
exten => 195,n,MYSQL(Fetch foundrow ${r} dialcount)
exten => 195,n,MYSQL(Clear ${r})
exten => 195,n,Set(totaldialcount=$[${dialcount} + 1])
exten => 195,n,MYSQL(Query r ${connid} UPDATE ivrblXter_upload_tbl set dial_count='${totaldialcount}',callable=0,calldate='${currenttime}',callsid='${callsid}',ctid='${ctid}' where id='${leadid}' limit 1)
exten => 195,n,MYSQL(Query r ${connid} INSERT INTO obcalldetails SET calldate='${currenttime}',ccallstarttime='${call_start}',dst='${cnumber}',context='ivrblXter',campaign_queue='${camp_id}',channel='${CHANNEL}',accountcode='${leadid}',uniqueid='${callsid}',calltype='PDOB',dial_count='${totaldialcount}',ctid='${ctid}')
exten => 195,n,MYSQL(Disconnect ${connid})

exten => h,1,Set(starttime=${STRFTIME(${EPOCH},,%Y-%m-%d %H:%M:%S)})
exten => h,n,Set(agent=${CDR(dstchannel):4:4})
exten => h,n,Set(ttime=${IF($[${EXISTS(${agent})}] ?${CDR(billsec)}:0)})
exten => h,n,NoOp(${camp_id})
exten => h,n,MYSQL(Connect connid localhost root tumko34h1se ugcdial)
exten => h,n,MYSQL(Query r ${connid} SELECT linkedid FROM ivrblXter_upload_tbl INNER JOIN ugcdial.cdr as b on uniqueid=callsid WHERE callsid='${callsid}' limit 1)
exten => h,n,MYSQL(Fetch foundrow ${r} linkedid)
exten => h,n,Set(_linkedid=${linkedid})
;exten => h,n,MYSQL(Query r ${connid} UPDATE popup SET sr_id='${srid}',leadid=${leadid},ctid=${ctid} WHERE callid='${linkedid}')
exten => h,n,MYSQL(Query r ${connid} UPDATE obcalldetails SET linkedid='${linkedid}' WHERE uniqueid='${callsid}')
exten => h,n,MYSQL(Clear ${r})
exten => h,n,MYSQL(Disconnect ${connid})
exten => h,n,Set(dialstate=${IF($[ ${CDR(disposition)} = "NO ANSWER"]?"NOANSWER":${CDR(disposition)})})
exten => h,n,GotoIf($[$["${DIALSTATUS}" = "ANSWER"]]?fromAnswer:notFromAnswer)
;NOTDIALED disposition set
exten => h,n(notFromAnswer),Set(dialstate=${dialstate})
exten => h,n,Set(actualduration=$[${STRFTIME(${EPOCH},,%s)}-${call_start}])
exten => h,n,Set(actualtalktime=0)
exten => h,n,MYSQL(Connect connid localhost root tumko34h1se ugcdial)
exten => h,n,MYSQL(Query r ${connid} UPDATE obcalldetails set hanguptime='${starttime}',cdrduration='${CDR(duration)}',cdrbillsec='${ttime}',duration='${actualduration}',talktime='${actualtalktime}',disposition='${dialstate}' where accountcode='${leadid}' order by calldate desc limit 1 )
exten => h,n,MYSQL(Query r ${connid} UPDATE ivrblXter_upload_tbl set dialer_disposition='${dialstate}',dispose_id='0',subdispose='' where id='${leadid}' limit 1)
exten => h,n,MYSQL(Disconnect ${connid})

;dialer disposition upate api
exten => h,n,Set(DISP=${dialstate})
;exten => h,n,Set(dispupdateapiReq=http://localhost/sdnext/api/updatedisposition/${leadid}/${callsid}/${DISP})
;exten => h,n,Set(CURLOPT(httptimeout)=2)
;exten => h,n,Set(CURLOPT(conntimeout)=2)
;exten => h,n,Set(dispupdateapiRes==${CURL(${dispupdateapiReq})})
exten => h,n,Hangup()

exten => h,n(fromAnswer),NoOp('answer')
exten => h,n(fromAnswer),Hangup()




[ivrbXtersubmenu]

exten => s,1,Set(CALLERID(num)=${cnumber})
exten => s,n,Set(currenttime=${STRFTIME(${EPOCH},,%Y-%m-%dT%H:%M:%S)})
exten => s,n,set(_leadid=${leadid})
exten => s,n,MYSQL(Connect connid 127.0.0.1 root tumko34h1se ugcdial)
exten => s,n,MYSQL(Query r ${connid} UPDATE obcalldetails SET queueentertime='${currenttime}' WHERE accountcode='${leadid}' AND calldate >=CURDATE() ORDER BY calldate DESC LIMIT 1 )
exten => s,n,MYSQL(Query r ${connid} SELECT ccallstarttime from obcalldetails where accountcode='${leadid}' ORDER BY calldate DESC LIMIT 1)
exten => s,n,MYSQL(Fetch foundrow ${r} ccallstarttime)
exten => s,n,MYSQL(Clear ${r})
exten => s,n,MYSQL(Disconnect ${connid})
exten => s,n,Set(ccallstarttime=${ccallstarttime})
exten => s,n,MYSQL(Connect connid localhost root tumko34h1se ugcdial)
exten => s,n,MYSQL(Query r ${connid} SELECT callsid from ivrblXter_upload_tbl where id ='${leadid}'ORDER BY calldate DESC LIMIT 1)
exten => s,n,MYSQL(Fetch foundrow ${r} callsid)
exten => s,n,Set(_callsid=${callsid})
exten => s,n,MYSQL(Query r ${connid} SELECT linkedid FROM ivrblXter_upload_tbl INNER JOIN ugcdial.cdr as b on uniqueid=callsid WHERE callsid='${callsid}' limit 1)
exten => s,n,MYSQL(Fetch foundrow ${r} linkedid)
exten => s,n,Set(_linkedid=${linkedid})
exten => s,n,MYSQL(Query r ${connid} UPDATE ivrblXter_upload_tbl SET agent=${linkedid} WHERE callsid='${callsid}')
exten => s,n,MYSQL(Clear ${r})
exten => s,n,MYSQL(Disconnect ${connid})
exten => s,n,Goto(ext-ttss,1,1)
exten => s,n,Hangup()


exten => h,n,Set(actualduration=$[${STRFTIME(${EPOCH},,%s)}-${ccallstarttime}])
exten => h,n,Set(actualtalktime=${IF($[${EXISTS(${agent})}]?$[${STRFTIME(${EPOCH},,%s)}-${cqueueanswertime}]:0)})
exten => h,n,Set(ttime=${IF($[${EXISTS(${agent})}] ?${CDR(billsec)}:0)})
exten => h,n,NoOp(${campaign})
exten => h,n,set(isAbandon=${IF($[${EXISTS(${agent})}]?0:1)})
exten => h,n,set(dialstate=${IF(${isAbandon} = 1  ?Abandoned :${CDR(disposition)})})
exten => h,n,MYSQL(Connect connid localhost root tumko34h1se ugcdial)
exten => h,n,MYSQL(Query r ${connid} UPDATE obcalldetails set hanguptime='${currenttime}',cdrduration=${CDR(duration)},cdrbillsec=${ttime},duration='${actualduration}',talktime='${actualtalktime}',disposition='${dialstate}' where accountcode='${leadid}' order by calldate desc limit 1)
exten => h,n,MYSQL(Query r ${connid} UPDATE ivrblXter_upload_tbl set dialer_disposition='${dialstate}' where id='${leadid}' limit 1)
exten => h,n,MYSQL(Query r ${connid} SELECT callsid from ivrblXter_upload_tbl where id='${leadid}' limit 1)
exten => h,n,MYSQL(Fetch foundrow ${r} origcallid)
exten => h,n,MYSQL(Clear ${r})
exten => h,n,MYSQL(Disconnect ${connid})

;Dialer disposition update
exten => h,n,Set(DISP=${dialstate})
exten => h,n,GotoIf($["${DISP}"="Abandoned"]?abandoned:answered)
exten => h,n,Hangup()
exten => h,n(answered),NoOp(AnsweredCall)
exten => h,n,Hangup()


[ext-ttss]
include => ext-ttss-custom
exten => 1,1,Noop(TTS: AccountNumber.)
exten => 1,n,Noop(Using: flite)
exten => 1,n,Answer
exten => 1,n,AGI(propolys-tts.agi,"Your account number is ${leadid}",flite,/usr/bin/flite)
exten => 1,n,Goto(ext-ttss,2,1)

exten => 2,1,Noop(TTS: LoneNumber.)
exten => 2,n,Noop(Using: flite)
exten => 2,n,Answer
exten => 2,n,AGI(propolys-tts.agi,"Your lone number is ${cnumber}",flite,/usr/bin/flite)
exten => 2,n,Hangup()



;--== end of [ext-ttss] ==--;








[click2call]
exten => _X.,1,Set(tempo=${CUT(CHANNEL,/,2)})
exten => _X.,n,Set(extension=${CUT(tempo,-,1)})
exten => _X.,n,NoOP("Call for ${extension} Extension")
exten => _X.,n,goto(default,6013${EXTEN},1)
exten => _X.,n,Hangup

[webcallback]
;context used to handle callback requests made from the webpage
exten => callMeEN,1,NoOp(Callback request from webpage, EN)
same => n,Answer()
same => n,Wait(1.5)
same => n,agi(googletts.agi,"Please hold for Pierre.")
same => n,Wait(1)
same => n,Set(CALLERID(all)="Web Callback" <5554561234>)
same => n,Dial(SIP/cwu-pierre/${routeType}${cellPierrePrefix}${cellPierreNum})
same => n,Hangup()

exten => callMeFR,1,NoOp(Callback request from webpage, FR)
same => n,Answer()
same => n,Wait(1.5)
same => n,agi(googletts.agi,"Je vous mets en relation avec Pierre, un instant je vous prie.",fr,,1.5)
same => n,Wait(1)
same => n,Set(CALLERID(all)="Web Callback" <5554561234>)
same => n,Dial(SIP/cwu-pierre/${routeType}${cellPierrePrefix}${cellPierreNum})
same => n,Hangup()





[temp-queues]
exten => _X.,1,Answer()
;exten => _X.,n,Queue(sales,twW,,,40}
;exten => _X.,1,GoTo(queue-status,${EXTEN},1)
;01 => INB
exten => 01,1,GoSub(queue-status,${EXTEN},1(INBOUND))
;02 => OUTB
exten => 02,1,GoSub(queue-status,${EXTEN},1(OUTBOUND))

;03 => BREAK

exten => 03,1,GoSub(queue-status,${EXTEN},1(PAUSED))

;04 => LOGOUT
exten => 04,1,GoSub(queue-status,${EXTEN},1(LOGOUT))

exten => _X.,n,Queue(sales,twW,,,queue-status,${EXTEN},1}

exten => h,1,NoOp(Ending Queue Call)
same=> n,Hangup()


[queue-status]
exten => _X.,1,Set(FIRST_STATUS=${ARG1})
exten => _X.,n,Set(CH=SIP/${CHANNEL(peername)})
exten => _X.,n,MYSQL(Connect connid localhost root tumko34h1se worxdialer)
exten => _X.,n,MYSQL(Query resultid ${connid} select status from t_queue where channel='${CH}')
exten => _X.,n,MYSQL(Fetch foundrow ${resultid} status)
exten => _X.,n,MYSQL(clear ${resultid})
exten => _X.,n,MYSQL(Disconnect ${connid})
exten => _X.,n,NoOp(RETURN_PROVIDER: ${status})
exten => _X.,n,GotoIf($["${status}" = "" ]?queue-add,${EXTEN},1:queue-${FIRST_STATUS},${EXTEN},1)

[queue-add]
exten => _X.,1,SET(CH=SIP/${CHANNEL(peername)})
exten => _X.,n,MYSQL(Connect connid localhost root tumko34h1se worxdialer)
exten => _X.,n,MYSQL(Query resultid ${connid} insert into t_queue(channel,status) values ('${CH}','${FIRST_STATUS}'))
exten => _X.,n,MYSQL(Disconnect ${connid})
exten => _X.,n,AddQueueMember(sales,${CH})
exten => _X.,n,Playback(beep)
exten => _X.,n,Hangup()

[queue-INBOUND]
exten => _X.,1,SET(CH=SIP/${CHANNEL(peername)})
exten => _X.,n,MYSQL(Connect connid localhost root tumko34h1se worxdialer)
exten => _X.,n,MYSQL(Query resultid ${connid} update t_queue set channel='${CH}',status='INBOUND' where channel='${CH}')
exten => _X.,n,MYSQL(Disconnect ${connid})
exten => _X.,n,AddQueueMember(sales,${CH})
exten => _X.,n,Playback(beep)
exten => _X.,n,Hangup()

[queue-OUTBOUND]
exten => _X.,1,SET(CH=SIP/${CHANNEL(peername)})
exten => _X.,n,MYSQL(Connect connid localhost root tumko34h1se worxdialer)
exten => _X.,n,MYSQL(Query resultid ${connid} update t_queue set status='OUTBOUND' where channel='${CH}')
exten => _X.,n,MYSQL(Disconnect ${connid})
exten => _X.,n,RemoveQueueMember(sales,${CH})
exten => _X.,n,Playback(beep)
exten => _X.,n,Hangup()

[queue-PAUSED]
exten => _X.,1,SET(CH=SIP/${CHANNEL(peername)})
exten => _X.,n,MYSQL(Connect connid localhost root tumko34h1se worxdialer)
exten => _X.,n,MYSQL(Query resultid ${connid} update t_queue set status='PAUSED' where channel='${CH}')
exten => _X.,n,MYSQL(Disconnect ${connid})
exten => _X.,n,RemoveQueueMember(sales,${CH})
exten => _X.,n,Playback(beep)
exten => _X.,n,Hangup()

[queue-LOGOUT]
exten => _X.,1,SET(CH=SIP/${CHANNEL(peername)})
exten => _X.,n,MYSQL(Connect connid localhost root tumko34h1se worxdialer)
exten => _X.,n,MYSQL(Query resultid ${connid} update t_queue set status='LOGOUT' where channel='${CH}')
exten => _X.,n,MYSQL(Disconnect ${connid})
exten => _X.,n,RemoveQueueMember(sales,${CH})
exten => _X.,n,Playback(beep)
exten => _X.,n,Hangup()

#include worxpbx.conf

[test-call-for-cid]
exten => _X.,1,NoOP("<--------------Fetch Caller ID-------------->")
same=> n,Set(CALLERID(name)=${CALLERID(name)})
same=> n,Set(CALLERID(num)=${CALLERID(num)})
same=> n,Noop(catching the caller Server IP is  ${CHANNEL(recvip)})
same=> n,Noop(catching the caller id is ${CALLERID(all)})
same=> n,Verbose(1,***** catching the caller dialing number is ${EXTEN} *******)
same=> n,GoSub(SubMysqlblacklist,s,1())
same=> n,GotoIf($[${CALLERID(name)} = ""]?reject:allow)
same=> n,GotoIf($[${CALLERID(num)} = ""]?reject:allow)
same=> n(allow),Macro(checkblacklist,${CALLERID(num)})
same=> n,Set(GROUP()=Cellular)
same=> n,Verbose(1,**** Number of concurrent calls are ${GROUP_COUNT(Cellular)})
same=> n,Set(CDR(userfield)=${CHANNEL(recvip)})
same=> n,GotoIf($[${GROUP_COUNT(Cellular)} > 20]?999:limit)
;same=> n(limit),Goto(Voips-Call,${EXTEN},1)
same=> 999,Verbose(1,***Number of concurrent calls are ${GROUP_COUNT(Cellular)}  over limit)
same=> n,playback(all-circuits-busy-now)
same=> n,Set(DIALSTATUS=CHANUNAVAIL)
same=> n,playback(goodbye)
same=> n,Hangup
same=> n(reject),Playback(abandon-all-hope)
same=> n,Hangup()

[va-Celular]
exten => _X.,1,Set(tempo=${CUT(CHANNEL,/,2)})
exten => _X.,n,Set(extension=${CUT(tempo,-,1)})
exten => _X.,n,Set(WhiteList=true)
exten => _X.,n,AGI(whiteList.php,${CALLERID(dnid)})
exten => _X.,n,GotoIf($["${WhiteList}" = "true"]?continue:exit)
exten => _X.,n(continue),Set(userid=${GENERIC_WORX(SELECT `user_id` FROM `cc_sip_buddies` WHERE `name`= ${extension})})
exten => _X.,n,Set(CDR(user_id)=${userid})
exten => _X.,n,Set(CDR(call_type)=0)
exten => _X.,n,Set(out_cli=${GENERIC_WORX(SELECT `callerid` FROM `cc_sip_buddies` WHERE `name`= ${extension})})
exten => _X.,n,Set(CALLERID(num)=${out_cli})
exten => _X.,n,Set(CDR(Recordings)=${UNIQUEID}.wav)
exten => _X.,n,Set(destination=${GENERIC_WORX(select queue_name from cc_queue_member_table where membername=${extension})})
exten => _X.,n,Set(CDR(dest_name)=${destination})
exten => _X.,n,Set(CDR(extension)=${extension})
;exten => _X.,n,AGI(a2billing.php,1)
exten => _X.,n,AGI(SSagi/bigpbx.php,4,did)
exten => _X.,n(exit),Hangup
exten => _X.,n,Hangup
exten => h,1,ExecIf($[${lc_id} != ""]?Set(WP_LC_END(`id`)=${lc_id}))
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 2)})
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 3)})
exten => h,n,NoOp()



[internal-users]
exten => _X.,1,NoOP("<--------------BigPBX Dialer System for Internal And External Calling-------------->")
same=> n,GoSub(SubMysqlblacklist,s,1())
same=> n,Noop(catching the caller Server IP is  ${CHANNEL(recvip)})
same=> n,Noop(catching the caller id is ${CALLERID(num)})
same=> n,Verbose(1,***** catching the caller dialing number is ${EXTEN} *******)
same=> n,Set(tempo=${CUT(CHANNEL,/,2)})
same=> n,Set(extension=${CUT(tempo,-,1)})
same=> n,Set(__edu_agent=${GENERIC_WORX(SELECT `agent_name` FROM `cc_sip_buddies` WHERE `name`= ${extension})})
same=> n,Set(userid=${GENERIC_WORX(SELECT `id_cc_card` FROM `cc_sip_buddies` WHERE `name`= ${extension})})
same=> n,Set(CDR(user_id)=${userid})
same=> n,Set(out_cli=${GENERIC_WORX(SELECT `callerid` FROM `cc_sip_buddies` WHERE `name`= ${extension})})
same=> n,Set(CALLERID(num)=${out_cli})
same=> n,GotoIf($["${out_cli}" = "0"]?reject:allow)
same=> n,GotoIf($[${CALLERID(num)} = " "]?reject:allow)
same=> n(allow),Macro(checkblacklist,${CALLERID(num)})
same=> n,Set(GROUP()=Cellular)
same=> n,Verbose(1,**** Number of concurrent calls are ${GROUP_COUNT(Cellular)})
same=> n,Set(CDR(userfield)=${CHANNEL(recvip)})
same=> n,GotoIf($[${GROUP_COUNT(Cellular)} > 80]?999:limit)
same=> n(limit),Goto(Cellular,${EXTEN},1)
same=> 999,Verbose(1,***Number of concurrent calls are ${GROUP_COUNT(Cellular)}  over limit)
same=> n,playback(all-circuits-busy-now)
same=> n,Set(DIALSTATUS=CHANUNAVAIL)
same=> n,playback(goodbye)
same=> n,Hangup
same=> n(reject),Agi(SSagi/googletts.agi,"Dear${edu_agent}.We are required Caller ID to process the calling. Get help to I T Team to set Caller ID on ${extension}Extension Thank you!",en);
;same=> n,Playback(goodbye)
same=> n,Hangup()

[scammer-jammer]
exten=>1,1,Playback(abandon-all-hope)
same=>n,Hangup

[callflood]
 exten => s,1,Answer
 exten => s,2,Set(CALLFILENAME=radcontest-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)},g)
 exten => s,3,Monitor(wav,${CALLFILENAME},m)
 exten => s,4,Wait(1)
 exten => s,5,Playback(/var/lib/asterisk/sounds/tt-monkeys)
 exten => s,6,Hangup()

[sssssssclick2call]
exten => s,1,MySQL(Connect connid localhost root tumko34h1se worxdialer)
exten => s,2,MySQL(Query resultid ${connid} SELECT callbacknum FROM callback_callers WHERE queuename = ${EXTEN})
exten => s,3,MySQL(Fetch fetchid ${resultid} callbacknum)
exten => s,5,MYSQL(Clear ${resultid})
exten => s,6,MYSQL(Disconnect ${connid})
exten => s,1,Dial(SIP/NET2-CALL/${phone})
exten => s,1,Goto(AngelusBell,startbell,1)
exten => h,1,System(/usr/local/scripts/callback.sh ${callbacknum})


[click2call]
exten => s,1,Dial(SIP/NET2-CALL/${phone})

[call-to]
exten => callback,1,Read(NUM,input-number,4,n,1,5)
exten => callback,n,DIAL(SIP/${NUM})

[app-autodial]
;exten => s,1,NoOP()
;exten => 35555555,2,Dial(SIP/${EXTEN}@NET2-CALL)
;exten => _X.,1,Set(_SIPADDHEADER24=X-voipnow-channel: 2)
;exten => s,1,NoOP()
;same=>n,Goto(Cellular,${EXTEN},1)
exten => _X.,1,Set(_SIPADDHEADER24=Callback channel:2)
exten => _X.,2,Dial(SIP/${EXTEN}@NET2-CALL)



[AngelusBell]
exten => startbell,1,Answer
exten => startbell,n,System(asterisk -rx "channel originate Local/callviking@AngelusBell/n extension playbell@AngelusBell")
exten => startbell,n,Hangup
exten => callviking,1,Dial(SIP/Y,10,D(5))  ;calls my ATA to my paging box and plays 5 tone
exten => callviking,2,Hangup
exten => playbell,1,Answer
exten => playbell,2,Playback(hello)
exten => playbell,3,Hangup

[current-setup]
exten => s,1,MySQL(Connect connid localhost root tumko34h1se bigdialer)
exten => s,2,MySQL(Query resultid ${connid} SELECT callbacknum FROM callback_callers WHERE callback=1)
exten => s,3,MySQL(Fetch fetchid ${resultid} callbacknum)
;exten => s,4,Goto(internal-users,${callbacknum},1)
exten => s,4,MYSQL(Clear ${resultid})
exten => s,5,MYSQL(Disconnect ${connid})
exten => h,1,NoOp(copy callback.call file to /var/spool/asterisk/outgoing)
exten => h,n,System(echo -e "Channel: SIP/NET2-CALL/${callbacknum}\\nContext: callqueue\\nCallerid: 19177225031\\nExtension: 19177225031" > /tmp/${UNIQUEID}.call)
exten => h,n,System(/bin/sleep 10s)
exten => h,n,System(mv /tmp/${UNIQUEID}.call /var/spool/asterisk/outgoing/)
exten => h,n,MySQL(Connect connid localhost root tumko34h1se bigdialer)
exten => h,n,MYSQL(Query resultid ${connid} UPDATE callback_callers SET callback=0 WHERE callbacknum =${callbacknum})
exten => s,n,MySQL(Fetch fetchid ${resultid} callback)
exten => h,n,MYSQL(Clear ${resultid})
exten => h,n,MYSQL(Disconnect ${connid})

[worxpbx-outcall]
include => internal-xfer
exten => _195,1,goto(ivrblXter,195,1)
exten => _19177225031,1,Goto(DID-TFN,${EXTEN},1)
exten => _19177225032,1,Goto(DID-TFN,${EXTEN},1)
exten => _19177225033,1,Goto(DID-TFN,${EXTEN},1)
exten => _#00999X.,1,NoOP()
exten => _#00999X.,n,Goto(coming-out,${EXTEN:6},1)

;################# Tata PRI Line##################
;exten => _X.,1,Goto(s,1)
;exten => s,1,Noop(Let us look deeper into the soul of the invite)
;exten => s,n,Set(pseudodid=${SIP_HEADER(To)})
;exten => s,n,Set(pseudodid=${CUT(pseudodid,@,1)})
;exten => s,n,Set(pseudodid=${CUT(pseudodid,:,2)})
;exten => s,n,Goto(tatadids,${pseudodid},1)
;[tatadids];incoming of 1000
;exten => _7966810000,1,Dial(SIP/1000,30,r) 
;exten => _7966810000,2,Hangup()
;incoming of 1001
;exten => _7966810001,1,Dial(SIP/1001,30,r) 
;exten => _7966810001,2,Hangup()
;exten => _77225031,3,goto(testing-callback,${EXTEN},1)

;exten => _X.,1,Goto(test-call-for-cid,${EXTEN},1)
;########################################################


;i;i;;;;;;;exten => _00442037690799,1,Dial(SIP/808,20,Tt)

exten => _19177225036,1,NoOp(Handling incoming to do cool stuff)
same => n,Set(GROUP()=${EXTEN})
same => n,Macro(didchoke)



exten => _00X.,1,Goto(internal-users,${EXTEN:2},1)
exten => _0.,1,Set(__result1=${EXTEN:1})
exten => _0.,n,Goto(Internal-Call-Trasfer,${result1},binternal)
exten => _0.,n,Hangup
exten => _X.,1,Goto(extensions-to-extensions,${EXTEN},1)
;exten => 602,1,Goto(ConferenceRooms,${EXTEN},1)
; trunk failover testing
;exten => _1878.,1,Goto(test-calling,${EXTEN},1)
exten => _18077225030,1,Verbose(1,--- Dialing out from Trunk A)
same=> n,Noop(catching the caller Server IP is  ${CHANNEL(recvip)})
same=> n,Noop(catching the caller id is ${CALLERID(num)})
same=> n,Verbose(1,***** catching the caller dialing number is ${EXTEN} *******)
same=> n,Macro(checkblacklist,${CALLERID(num)})
same=> n,Set(GROUP()=Cellular)
same=> n,Verbose(1,**** Number of concurrent calls are ${GROUP_COUNT(Cellular)})
same=> n,Set(CDR(userfield)=${CHANNEL(recvip)})
same=> n,GotoIf($[${GROUP_COUNT(Cellular)} > 31]?999:limit)
same=> n(limit),Goto(Cellular,${EXTEN:2},1)
same=> 999,Verbose(1,***Number of concurrent calls are ${GROUP_COUNT(Cellular)}  over limit)
same=> n,playback(all-circuits-busy-now)
same=> n,Set(DIALSTATUS=CHANUNAVAIL)
same=> n,playback(goodbye)
same=> n,Hangup
same=> n,Set(NETWORKSTATUS=${SIPPEER(sip_trunkA-out,status)})
same=> n,Gotoif($[NETWORKSTATUS=UNREACHABLE]?trunkB:trunkA)
same=> n(trunkA),Dial(SIP/ServerA/${EXTEN:1})
same=> n,Hangup
same=> n(trunkB),Dial(SIP/ServerB/${EXTEN})
same=> n,Hangup

exten => _2125551212,1,AGI(SSagi/truecnam.agi)
exten => _2125551212,n,ExecIf($[${SPAMSCORE} > 40]?Set(CALLERID(name)=(SPAM ${SPAMSCORE}) ${CALLERID(name)})
exten => _2125551212,n,GotoIf($[${SPAMSCORE} > 40]?Lenny,Lenny,1)
exten => _2125551212,n,ExecIf($["${TRUECNAMSHORT}" != ""]?Set(CALLERID(name)=${TRUECNAMSHORT}))
exten => _2125551212,n,Dial(SIP/001)


;; chain spy code
;exten => _*7192x.#,1,Answer
;exten => _*7192x.#,n,NoCDR
;exten => _*7192x.#,n,Wait(1)
;exten => _*7192x.#,n,ChanSpy(sip/${EXTEN:5},q)
;exten => _*7192x.#,n,Hangup
;exten => 19177225031,1,Goto(callvia_a2b,${EXTEN},1)
;exten => 19177225031,1,Progress()
;exten => _X.,1,AGI(gethits.php)
;exten => 19177225031,n,AGI(SSagi/count.php)
;exten => 19177225031,n,playback(vm-goodbye)
;;
;exten => 19177225031,1,Progress()
;exten => 19177225031,n,AGI(SSagi/single_ivr_play.php)
;exten => 19177225031,n,playback(vm-goodbye)
;exten => _*.,1,Set(__result="extensions")

[OutBond-Call-Trasfer]
exten => _X.,1(binternal),NoOP()
exten => _X.,n,Set(tempo=${CUT(CHANNEL,/,2)})
exten => _X.,n,Set(extension=${CUT(tempo,-,1)})
exten => _X.,n,Set(iduser=${GENERIC_WORX(SELECT `user_id` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,Set(CDR(user_id)=${iduser})
exten => _X.,n,Set(destination=${GENERIC_WORX(select queue_name from cc_queue_member_table where membername=${result1})})
exten => _X.,n,Set(CDR(dest_name)=${destination})
exten => _X.,n,Set(agentName=${GENERIC_WORX(SELECT `agent_name` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,Set(CDR(user_id)=${iduser})
exten => _X.,n,Set(CDR(call_type)=0)
exten => _X.,n,Set(out_cli=${GENERIC_WORX(SELECT `callerid` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,Set(destination=${GENERIC_WORX(select queue_name from cc_queue_member_table where membername=${result1})})
exten => _X.,n,Set(CDR(dest_name)=${destination})
exten => _X.,n,Set(agentName=${GENERIC_WORX(SELECT `agent_name` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,Set(dial_out=${GENERIC_WORX(SELECT `dial_timeout` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,Set(callstatus=Call-Transfer)
;exten => _X.,n,Set(dialnum=${EXTEN})
exten => _X.,n,Set(dialnum=${result1})
exten => _X.,n,Set(CALLERID(num)=${out_cli})
exten => _X.,n,Set(CDR(Recordings)=${UNIQUEID}.wav)
exten => _X.,n,Set(CDR(extension)=${result1})
exten => _X.,n,Mixmonitor(${UNIQUEID}.wav,b)
exten => _X.,n,Set(ext_status=${GENERIC_WORX(SELECT `paused` FROM `cc_queue_member_table` WHERE `queue_name` =${destination} AND `membername` = ${result1})})
exten => _X.,n(action),GotoIf($["${ext_status}" = "1"]?exit:)
exten => _X.,n,GoSub(live_call,1)
;exten => _X.,n,Dial(SIP/${dialnum},${dial_out},tTH,,,U(ext_ans,${UNIQUEID}^${result1}))
exten => _X.,n,Dial(SIP/${result1},${dial_out},U(transfer_ans,${UNIQUEID}^${result1}))
exten => _X.,n,StopMixMonitor(${mixmvar})
exten => _X.,n,NoOp(dialstatus :: ${DIALSTATUS})
;exten => _X.,n,VoiceMail(${EXTEN}@default)
exten => _X.,n,Verbose(  dialstatus is ${DIALSTATUS} CHANUNAVAIL )
exten => _X.,n,GotoIf($[${DIALSTATUS}" = "NOANSWER"]?vmmain-ext,${dialnum},1:finish_extension)
exten => _X.,n,GotoIf($[${DIALSTATUS}" = "CHANUNAVAIL"]?vmmain-ext,${dialnum},1:finish_extension)
exten => _X.,n,GotoIf($[${DIALSTATUS}" = "BUSY"]?vmmain-ext,${dialnum},1:finish_extension)
exten => _X.,n,Set(extenfail=${GENERIC_WORX(SELECT `fail_status` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${extenfail}" = "Y"]?:finish_extension)
exten => _X.,n,Verbose( call is terminated)
exten => _X.,n,Set(__result=${GENERIC_WORX(SELECT `fail_dest` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${result}" = ""]?finish_extension)
exten => _X.,n,Set(__result1=${GENERIC_WORX(SELECT `fail_data` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${result1}" = ""]?jumping-priority,${global_did},1)
exten => _X.,n(finish_extension),Hangup
exten => _X.,n(exit),Hangup
;exten => _X.,n(exit),Goto(jumping-priority,${global_did},1)
exten => live_call,1,Set(WP_LC_BEGIN(${iduser},${UNIQUEID},${dialnum},${result1},${destination},${callstatus},2,${dialnum},${CHANNEL})=)
exten => live_call,n,Set(__lc_id=${WP_LC_BEGIN(${iduser},${UNIQUEID},${dialnum},${dialnum},${destination},${callstatus},2,${dialnum},${CHANNEL})})
exten => live_call,n,Return
exten => h,1,ExecIf($[${lc_id} != ""]?Set(WP_LC_END(`id`)=${lc_id}))
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 2)})
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 3)})
exten => h,n,NoOp()


[Cellular]
exten => _X.,1,Progress
;exten => _X.,n,Set(CALLERID(all)=124${extension})
exten => _X.,n,Set(tempo=${CUT(CHANNEL,/,2)})
exten => _X.,n,Set(extension=${CUT(tempo,-,1)})
exten => _X.,n,Set(HANGUP_OWNER=Caller)  ; we hung up
exten => _X.,n,ExecIf($[${EXTEN:0:3} = 261]?goto(exit))
exten => _X.,n,ExecIf($[${EXTEN:0:3} = 244]?goto(exit))
exten => _X.,n,ExecIf($[${EXTEN:0:3} = 236]?goto(exit))
exten => _X.,n,ExecIf($[${EXTEN:0:3} = 682]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:4} = 3587]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:4} = 3582]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:2} = 53]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:2} = 20]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:2} = 58]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:2} = 40]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:2} = 92]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 649]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 784]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 758]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 011]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 252]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 880]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 254]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 251]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 218]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 599]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 250]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 221]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 963]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 992]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 216]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 380]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 998]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 379]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 218]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:2} = 20]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:2} = 86]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:2} = 98]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:2} = 88]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:2} = 53]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:2} = 58]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:2} = 40]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:2} = 92]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 649]?goto(exit))
exten => _X.,n,ExecIf($[${EXTEN:0:3} = 784]?goto(exit))
exten => _X.,n,ExecIf($[${EXTEN:0:3} = 758]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:2} = 48]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 252]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 254]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 880]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 254]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 011]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 251]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 218]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 599]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 250]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 221]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 963]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 992]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 216]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 380]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 998]?goto(exit))
;exten => _X.,n,ExecIf($[${EXTEN:0:3} = 379]?goto(exit))
exten => _X.,n,Set(iduser=${GENERIC_WORX(SELECT `id_cc_card` FROM `cc_sip_buddies` WHERE `name`= ${extension})})
exten => _X.,n,Set(CDR(user_id)=${iduser})
exten => _X.,n,Set(destination=${GENERIC_WORX(select queue_name from cc_queue_member_table where membername=${extension})})
exten => _X.,n,Set(CDR(dest_name)=${destination})
exten => _X.,n,Set(agentName=${GENERIC_WORX(SELECT `agent_name` FROM `cc_sip_buddies` WHERE `name`= ${extension})})
exten => _X.,n,Set(CDR(call_type)=0)
exten => _X.,n,Set(out_cli=${GENERIC_WORX(SELECT `callerid` FROM `cc_sip_buddies` WHERE `name`= ${extension})})
exten => _X.,n,Set(destination=${GENERIC_WORX(select queue_name from cc_queue_member_table where membername=${extension})})
exten => _X.,n,Set(CDR(dest_name)=${destination})
exten => _X.,n,Set(agentName=${GENERIC_WORX(SELECT `agent_name` FROM `cc_sip_buddies` WHERE `name`= ${extension})})
exten => _X.,n,Set(dial_out=${GENERIC_WORX(SELECT `dial_timeout` FROM `cc_sip_buddies` WHERE `name`= ${extension})})
exten => _X.,n,Set(callstatus=OutBOND)
exten => _X.,n,Set(dialnum=${EXTEN})
exten => _X.,n,Set(CALLERID(num)=${out_cli})
exten => _X.,n,Set(CDR(Recordings)=${UNIQUEID}.wav)
exten => _X.,n,Set(CDR(extension)=${extension})
;exten => _X.,n,playback(call-recorded-monitored)
exten => _X.,n,Mixmonitor(${UNIQUEID}.wav,b)
exten => _X.,n,Set(ext_status=${GENERIC_WORX(SELECT `paused` FROM `cc_queue_member_table` WHERE `queue_name` =${destination} AND `membername` = ${extension})})
exten => _X.,n,GotoIf($[${ext_status}" = 1]?dial-${ext_status},1)
exten => _X.,n,GoSub(live_call,1)
exten => _X.,n,playback(prepaid-callback_intro)
;exten => _X.,n,GoSub(checktime,1)
exten => _X.,n,AGI(SSagi/worxdialer.php,1)
exten => _X.,n,playback(goodbye)
exten => _X.,n,Set(HANGUP_OWNER=Callee)  ; they hung up
exten => _X.,n(exit),playback(prepaid-not-authorized-phonenumber&goodbye)
exten => live_call,1,Set(WP_LC_BEGIN(${iduser},${UNIQUEID},${dialnum},${out_cli},${destination},${callstatus},2,${extension},${CHANNEL})=)
exten => live_call,n,Set(__lc_id=${WP_LC_BEGIN(${iduser},${UNIQUEID},${dialnum},${dialnum},${destination},${callstatus},2,${extension},${CHANNEL})})
exten => live_call,n,GoSub(Cellular_Outbond,s,1)
exten => live_call,n,Return()
exten => dial-1,1,NoOP("Hello Wait A Sec Mr. ${agentName}, I Found the Status of Extension No. ${extension} is OFF Please make it On To start the dialing")
exten => dial-1,n,Agi(SSagi/googletts.agi,"Hello Dear ${agentName}, I Found Your Extension, ${extension}!   is OFF, Please Ask To I T Team To make it enable To start the calling, Thank you!",en);
exten => dial-1,n,Hangup
;exten => checktime,1,GoToIfTime(20:00-07:00,*,*,*?hang)
;exten => checktime,n,return
;exten => checktime,n(hang),Agi(SSagi/googletts.agi,"Dear Team Member,Dialed Number Can not be completed,  Time Condition is enabled. Try to Dial after 7 O Clock! Thank you!",en);
exten => h,1,ExecIf($[${lc_id} != ""]?Set(WP_LC_END(`id`)=${lc_id}))
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 2)})
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 3)})
exten => h,n,NoOp(Hangup cause is ${HANGUPCAUSE})
exten => h,n,NoOp(Call Duration is ${CDR(duration)})

;; trabsfer string
exten => _0.,1,Set(__result1=${EXTEN:1})
exten => _0.,n,Goto(OutBond-Call-Trasfer,${result1},binternal)
exten => _0.,n,Hangup


[test-call]
exten => s,1,Answer()
exten => s,n,ChanIsAvail(SIP/${chan})
exten => s,n,NoOp(AVAILCHAN :: ${AVAILCHAN} :: AVAILORIGCHAN :: ${AVAILORIGCHAN} :: AVAILSTATUS :: ${AVAILSTATUS})
exten => s,n,Chanspy(SIP/${chan})
exten => s,n,HangUp()
exten => s,n(notvalid),PlayBack(all-circuits-busy-now)
exten => s,n,HangUp()







[didvmmain]
exten => _X.,1,Answer
;exten => _X.,n,AGI(SSagi/announcement.agi)
;exten => _X.,n,AGI(SSagi/setaccode.agi)
;exten => _X.,n,GoSub(did-ivr,s,1)
;exten => _X.,n,VoiceMail(${EXTEN},u,190)
;exten => _X.,n,VoiceMail(${result1},u,190)
exten => _X.,n,VoiceMail(${result1}@default)
exten => _X.,n,Hangup
exten => h,1,ExecIf($[${lc_id} != ""]?Set(WP_LC_END(`id`)=${lc_id}))
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 2)})
exten => h,n,NoOp()

[vmmain]
exten => _X.,1,Answer
exten => _X.,n,AGI(SSagi/setaccode.agi)
exten => _X.,n,GoSub(exten-ivr,s,1)
;exten => _X.,n,VoiceMail(${result1},u,190)
exten => _X.,n,VoiceMail(${result1}@default)
exten => _X.,n,Hangup
exten => h,1,ExecIf($[${lc_id} != ""]?Set(WP_LC_END(`id`)=${lc_id}))
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 2)})
exten => h,n,NoOp()

[vmmain-ext]
exten => _X.,1,Answer
exten => _X.,n,AGI(SSagi/setaccode.agi)
exten => _X.,n,GoSub(exten-ivr,s,1)
;exten => _X.,n,VoiceMail(${result1},u,190)
exten => _X.,n,VoiceMail(${EXTEN}@default)
exten => _X.,n,Hangup
exten => h,1,ExecIf($[${lc_id} != ""]?Set(WP_LC_END(`id`)=${lc_id}))
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 2)})
exten => h,n,NoOp()


[gethits]
exten => _X.,1,Progress()
exten => _X.,n,Set(callstatus=Inbound)
exten => _X.,n,GoSub(live_call,1)
exten => _X.,n,Set(qtime_wait=${GENERIC_WORX(UPDATE cc_live_calls Set status = 2 WHERE id = ${lc_id})})
exten => _X.,n,Set(MONITOR_FILENAME=IN-${UNIQUEID}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)})
exten => _X.,n,MixMonitor(${MONITOR_FILENAME}.wav,b)
exten => _X.,n,Set(CDR(Recordings)=${MONITOR_FILENAME}.wav)
exten => _X.,n,Set(CDR(dest_name)=${result1})
exten => _X.,n,Set(__agentext=${GENERIC_WORX(SELECT `membername` FROM `cc_queue_member_table` WHERE `queue_name`= ${result1})})
exten => _X.,n,Set(qtime_out=${GENERIC_WORX(SELECT `timeout` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,Set(findpriority=${GENERIC_WORX(select priority did from cc_did_destination LEFT JOIN cc_did ON cc_did_destination.id_cc_did=cc_did.id where did=${CALLERID(dnid)})})
exten => _X.,n,Gosub(ccposition-gosub,s,1(${priority},${result1},${global_did}))
exten => _X.,n(jump2queue),Queue(${result1},twW,,,${time_out},,,sss-announcement,,${GOSUB_RETVAL})
exten => _X.,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 2)})
exten => _X.,n,Verbose( queuestatus is ${QUEUESTATUS} )
exten => _X.,n,GotoIf([$["${QUEUESTATUS}" = "TIMEOUT"]|$["${QUEUESTATUS}" = "JOINEMPTY"]]?:finish_queue)
exten => _X.,n,Set(qfail=${GENERIC_WORX(SELECT `fail_status` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${qfail}" = "Y"]?:finish_queue)
exten => _X.,n,Set(__result=${GENERIC_WORX(SELECT `fail_dest` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${result}" = ""]?finish_queue)
exten => _X.,n,Set(__result1=${GENERIC_WORX(SELECT `fail_data` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${result1}" = ""]?finish_queue:jumping,${EXTEN},start)
exten => _X.,n(finish_queue),Hangup
exten => live_call,1,Set(WP_LC_BEGIN(${userid},${UNIQUEID},${global_did},${global_clin},${result1},${callstatus},1,NULL,${CHANNEL})=)
exten => live_call,n,Set(__lc_id=${WP_LC_BEGIN(${userid},${UNIQUEID},${global_did},${global_clin},${result1},${callstatus},1,NULL,${CHANNEL})})
exten => live_call,n,Return()
exten => h,1,ExecIf($[${lc_id} != ""]?Set(WP_LC_END(`id`)=${lc_id}))
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 2)})
exten => h,n,NoOp()



[sss-announcement]
exten = s,1,NoOp()
same => n,Set(cut_channel=${CUT(CHANNEL,/,2)})
same => n,Set(cut_agent=${CUT(cut_channel,-,1)})
same => n,Set(CDR(extension)=${cut_agent})
same => n,Set(agent_name=${GENERIC_WORX(select agent_name from cc_sip_buddies where name = ${cut_agent})})
same => n,Set(DB(w2c_ext/${lc_id})=${cut_agent})
same => n,Set(DB(w2c_ext_name/${lc_id})=${agent_name})
same => n,Set(WP_LC_ANS(`agent_number`,`agent_name`,`call_status`,`id`,`status`,`modified`)=${cut_agent},${agent_name},Inbound(connected),${lc_id},3)
same => n,Set(voice=${GENERIC_WORX(select playback from cc_did where did=${global_did})})
same => n,GotoIf($["${voice}" = ""]?return:play)
same => n(play),Wait(1)
same => n,Playback(${voice})
same => n(return),Return()


[my-gosub]
exten => _X.,1,GoTo(s,1)
exten => s,1,NoOP()
   ; .. Some extra stuff
  same => n,Set(_agent=${global_clin})
  same => n,Queue(80001,120,TtRrU(SETBUSY)B(SETRINGING^1^1)))
  ; .. Some other extra stuff
  exten => h,1,UnPauseQueueMember(,SIP/${agent}@dialin/n)
  same => n,Hangup

[SETRINGING]
exten => 1,1,Set(GLOBAL(RINGING_CHANNEL_${agent})=${CHANNEL})
same => n,Set(${GOSUB_RESULT}__=CONTINUE)
same => n,Return

[SETBUSY]
exten => s,1,Verbose(Pausing ${agent} in all queues)
same => n,Set(GLOBAL(RINGING_CHANNEL_${agent})=none)
same => n,PauseQueueMember(,SIP/${agent}@dialin/n)
same => n,Set(${GOSUB_RESULT}__=CONTINUE)
same => n,Return

[ccposition-gosub]
exten => _X.,1,GoTo(s,1)
exten => s,1,Set(LOCAL(count)=${QUEUE_WAITING_COUNT(${ARG2})})
exten => s,n,While($[${count} >= 1])
exten => s,n,Set(LOCAL(queuechannel)=${QUEUE_GET_CHANNEL(${ARG2},${count})})
exten => s,n,Set(LOCAL(channelpriority)=${IMPORT(${queuechannel},priority)})
exten => s,n,Set(channelpriority=${GENERIC_WORX(SELECT `priority`  FROM `cc_live_calls` WHERE  `caller_number`=${global_clin})})
exten => s,n,NoOP(${channelpriority})
exten => s,n,Gotoif($[${channelpriority}<=${ARG1}]?:notequal)
exten => s,n,ExitWhile()
exten => s,n(notequal),Set(LOCAL(count)=${MATH(${count}-1,int)})
exten => s,n,EndWhile()
exten => s,n,Set(__push=${MATH(${count}+1,int)})
exten => s,n,NoOP(${push})
exten => s,n,Set(queue_channel=${GENERIC_WORX(select agent_channel from  cc_live_calls where caller_number=${global_clin})})
exten => s,n,NoOP(${queue_channel})
exten => s,n,return(${MATH(${count}+1,int)})



[bababa]
exten => _X.,1,Answer()
exten => _X.,n,Set(callstatus=Inbound)
exten => _X.,n,GoSub(live_call,1)
exten => _X.,n,Set(qtime_wait=${GENERIC_WORX(UPDATE cc_live_calls Set status = 2 WHERE id = ${lc_id})})
exten => _X.,n,Set(MONITOR_FILENAME=IN-${UNIQUEID}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)})
exten => _X.,n,MixMonitor(${MONITOR_FILENAME}.wav,b)
exten => _X.,n,Set(CDR(Recordings)=${MONITOR_FILENAME}.wav)
exten => _X.,n,Set(CDR(dest_name)=${result1})
exten => _X.,n,Set(__agentext=${GENERIC_WORX(SELECT `membername` FROM `cc_queue_member_table` WHERE `queue_name`= ${result1})})
exten => _X.,n,Set(qtime_out=${GENERIC_WORX(SELECT `timeout` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,Set(findpriority=${GENERIC_WORX(select priority did from cc_did_destination LEFT JOIN cc_did ON cc_did_destination.id_cc_did=cc_did.id where did=${CALLERID(dnid)})})
exten => _X.,n,GotoIf($[$["${newbooking}" = "1"] & $["${result1}" = "900221"]]?:toqueue)
exten => _X.,n,Set(position=1)
exten => _X.,n(toqueue),GotoIf($[$["${result1}" = "900221"]]?test-sssss,${EXTEN},1:queueRandom)
exten => _X.,n(queueRandom),Queue(${result1},twW,,,${qtime_out},,,test-announcement,,${position})
exten => _X.,n,Verbose(  queuestatus is ${QUEUESTATUS} )
exten => _X.,n,GotoIf($[${QUEUESTATUS}" = "TIMEOUT"]?jumping-priority,${global_did},1:finish_queue)
exten => _X.,n,GotoIf($[${QUEUESTATUS}" = "JOINEMPTY"]?jumping-priority,${global_did},1:finish_queue)
exten => _X.,n,Set(qfail=${GENERIC_WORX(SELECT `fail_status` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${qfail}" = "Y"]?:finish_queue)
exten => _X.,n,Set(__result=${GENERIC_WORX(SELECT `fail_dest` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${result}" = ""]?finish_queue)
exten => _X.,n,Set(__result1=${GENERIC_WORX(SELECT `fail_data` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${result1}" = ""]?finish_queue:jumping-priority,switchcall,start)
exten => _X.,n(finish_queue),Hangup
exten => _X.,n,Hangup()
exten => live_call,1,Set(WP_LC_BEGIN(${userid},${UNIQUEID},${global_did},${global_clin},${result1},${callstatus},1,NULL,${CHANNEL})=)
exten => live_call,n,Set(__lc_id=${WP_LC_BEGIN(${userid},${UNIQUEID},${global_did},${global_clin},${result1},${callstatus},1,NULL,${CHANNEL})})
exten => live_call,n,Return()
exten => h,1,ExecIf($[${lc_id} != ""]?Set(WP_LC_END(`id`)=${lc_id}))
exten => h,n,NoOP()

[test-sssss]
exten => _X.,1,NoOp(****** ******)
exten => _X.,n,Set(MONITOR_FILENAME=IN-${UNIQUEID}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)})
exten => _X.,n,MixMonitor(${MONITOR_FILENAME}.wav,b)
exten => _X.,n,Set(CDR(Recordings)=${MONITOR_FILENAME}.wav)
exten => _X.,n,Set(CDR(dest_name)=${result1})
exten => _X.,n,Set(MSISDN=${CALLERID(number)})
exten => _X.,n,Set(DIALED=${CALLERID(dnid)})
exten => _X.,n,Set(position=crm_call)
exten => _X.,n,Set(GLOBAL(CLID_TRAVEL)=${DIALED})
exten => _X.,n,Queue(${result1},twW,,,${qtime_out},,${position},test-announcement,,)
exten => _X.,n,Set(qfail=${GENERIC_WORX(SELECT `fail_status` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${qfail}" = "Y"]?:finish_queue)
exten => _X.,n,Set(__result=${GENERIC_WORX(SELECT `fail_dest` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${result}" = ""]?finish_queue)
exten => _X.,n,Set(__result1=${GENERIC_WORX(SELECT `fail_data` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${result1}" = ""]?finish_queue:jumping-priority,switchcall,start)
exten => _X.,n(finish_queue),Hangup
exten => _X.,n,Hangup()
exten => h,1,ExecIf($[${lc_id} != ""]?Set(WP_LC_END(`id`)=${lc_id}))
exten => h,n,set(agentName=${DB(w2c_ext/${lc_id})})
exten => h,n,set(extname=${DB(w2c_ext_name/${lc_id})})
exten => h,n,NoOp(time :: ${CDR(start)} :: agentName :: ${agentName} :: extn :: ${extname} :: calltype :: ${callstatus} :: callerid :: ${MSISDN} :: dnid :: ${DIALED})
exten => h,n,AGI(RDagi/hangupcall.php,${CDR(start)},${agentName},${extname},${callstatus},${MSISDN},${CDR(duration)},${DIALED})
exten => h,n,NoOp(${DB_DELETE(snva/cust_ansepoch_${UNIQUEID})})
exten => h,n,NoOp(${DB_DELETE(w2c_ext/${lc_id})})
exten => h,n,NoOp(${DB_DELETE(w2c_ext_name/${lc_id})})
exten => h,n,NoOp()


[macro-vip_call]
exten => s,1,Noop( *** Info From Queue : --  --  ***)
exten => s,n,Verbose( 2 called id dnid is ${CHANNEL})
exten => s,n,Set(channel=${CHANNEL})
exten => s,n,Set(agent=${CUT(channel,-,1)})
exten => s,n,Set(cid=${CONNECTEDLINE(name)})
exten => s,n,Verbose(dialed - ${CDR(clid)})
exten => s,n,AGI(SSagi/call_manage.php,${agent},${cid},${CLID_TRAVEL})


[NewBooking]
exten => _X.,1,Set(__newbooking="1")
exten => _X.,n,Goto(main-menu,${CALLERID(dnid)},1)
exten => _X.,n,hangup()

[VIP]
exten => s,1,Verbose(Pausing ${agent} in all queues)
same => n,Set(vipcall=${GENERIC_WORX(SELECT priority  FROM `cc_live_calls` WHERE caller_number =${global_clin})})
same => n,NoOP(${vipcall})
same => n,GotoIf($[${vipcall}" = "1"]?NEWCONTEXT)
same => n,(NEWCONTEXT),Goto(NEWCONTEXT,${global_did},1)
same => n,Set(${GOSUB_RESULT}__=CONTINUE)
same => n,Return

[NEWCONTEXT]
exten => _X.,1,NoOP("Welcome to my party for next context by callerid id ${global_clin}")
exten => _X.,n,dial(SIP/006&SIP/005)
;exten => _X.,n,Queue(${result1},twWU(SETBUSY)B(SETRINGING^1^1),,,${qtime_out},,,test-announcement,,${GOSUB_RETVAL})
exten => _X.,n,Verbose(queuestatus is ${QUEUESTATUS})
exten => _X.,n,GotoIf($[${QUEUESTATUS}" = "TIMEOUT"]?jumping-priority,${global_did},1:finish_queue)
exten => _X.,n,GotoIf($[${QUEUESTATUS}" = "JOINEMPTY"]?jumping-priority,${global_did},1:finish_queue)
exten => _X.,n,Set(qfail=${GENERIC_WORX(SELECT `fail_status` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${qfail}" = "Y"]?:finish_queue)
exten => _X.,n,Set(__result=${GENERIC_WORX(SELECT `fail_dest` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${result}" = ""]?finish_queue)
exten => _X.,n,Set(__result1=${GENERIC_WORX(SELECT `fail_data` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${result1}" = ""]?finish_queue:jumping-priority,switchcall,start)
exten => _X.,n,Hangup
exten => h,1,ExecIf($[${lc_id} != ""]?Set(WP_LC_END(`id`)=${lc_id}))
exten => h,n,NoOP()


[dddddddddddddd]
exten => s,1,NoOp(${CDR(dstchannel)})
same => n,Set(cut_channel=${CUT(CHANNEL,/,2)})
same => n,Set(cut_agent=${CUT(cut_channel,-,1)})
same => n,Set(CDR(extension)=${cut_agent})
same => n,Set(agent_name=${GENERIC_WORX(select agent_name from cc_sip_buddies where name = ${cut_agent})})
same => n,Set(DB(w2c_ext/${lc_id})=${cut_agent})
same => n,Set(DB(w2c_ext_name/${lc_id})=${agent_name})
same => n,Set(YBP_DCA_ABIL(`agent_number`,`agent_name`,`call_status`,`id`,`status`,`modified`)=${cut_agent},${agent_name},Inbound(connected),${lc_id},3)
same => n(return),Return()

[DID-TFN]
;exten => _18023918220,1,set(CALLERID(num)=Jeevach.com-${CALLERID(num)})
;exten => _18023918220,n,Goto(DID-CALLING,${EXTEN},1)

;;; Dialer Forqarding

exten => _18023918220,1,Dial(sip/18023918220@52.56.70.174:5060,,Tto);Harash  (Free)
exten => _61281034105,1,Dial(sip/61281034105@3.9.121.89:50070,,Tto);Harash  (Free)
exten => _61281034108,1,Dial(sip/61281034108@3.9.121.89:50070,,Tto);Harash  (Free)
exten => _61281034113,1,Dial(sip/61281034113@3.9.121.89:50070,,Tto);Harash  (Free)
exten => _61251335879,1,Dial(sip/61251335879@3.9.121.89:50070,,Tto);Harash  (Free)
exten => _61281034114,1,Dial(sip/61281034114@3.9.121.89:50070,,Tto);Harash  (Free)
exten => _61261452092,1,Dial(sip/61261452092@3.9.121.89:50070,,Tto);Harash  (Free)
exten => _61261452094,1,Dial(sip/61261452094@3.9.121.89:50070,,Tto);Harash  (Free)
exten => _61261452098,1,Dial(sip/61261452098@3.9.121.89:50070,,Tto);Harash  (Free)
exten => _61261452103,1,Dial(sip/61261452103@3.9.121.89:50070,,Tto);Harash  (Free)
exten => _61283111199,1,Dial(sip/61283111199@3.9.121.89:50070,,Tto);Harash  (Free) 
exten => _61283108888,1,Dial(sip/61283108888@3.9.121.89:50070,,Tto);Harash  (Free)
exten => _61383623791,1,Dial(sip/61383623791@3.9.121.89:50070,,Tto);Harash(BRIAN 102)
exten => _61383623792,1,Dial(sip/61383623792@3.9.121.89:50070,,Tto);Harash(Devinder Sharama Number 109)
exten => _61341089930,1,Dial(sip/61341089930@3.9.121.89:50070,,Tto);Harash( AMAN = 202)
exten => _61341089931,1,Dial(sip/61341089931@3.9.121.89:50070,,Tto);Harash (MARTIN 106)
exten => _61283106597,1,Dial(sip/61283106597@3.9.121.89:50070,,Tto);Harash (Queue Jeevach 90001)
exten => _61283114000,1,Dial(sip/61283114000@3.9.121.89:50070,,Tto);Harash  (Free)
exten => _61283119000,1,Dial(sip/61283119000@3.9.121.89:50070,,Tto);Harash (Free)


;;;
exten => _61390880344,1,Dial(sip/61390880344@3.9.121.89:50070,,Tto);; EXT 108
exten => _61390880347,1,Dial(sip/61390880347@3.9.121.89:50070,,Tto);; FREE
exten => _61390880326,1,Dial(sip/61390880326@3.9.121.89:50070,,Tto);; 107
exten => _61390084299,1,Dial(sip/61390084299@3.9.121.89:50070,,Tto);; Free
exten => _61390880372,1,Dial(sip/61390880372@3.9.121.89:50070,,Tto);; 105
;; old numbers
exten => _61357464631,1,Dial(sip/61357464631@3.9.121.89:50070,,Tto);  Website Number info@allfinewines.com.au
exten => _61384004251,1,Dial(sip/61384004251@3.9.121.89:50070,,Tto);; Vikram Number (101)
exten => _61384004283,1,Dial(sip/61384004283@3.9.121.89:50070,,Tto);  104
exten => _18026369402,1,Dial(sip/18026369402@3.9.121.89:50070,,Tto); PM SARDAR JI


;; NEW NUMBERS FROM DIDWW VENDR
exten => _61290373857,1,Dial(sip/61290373857@3.9.121.89:50070,,Tto);  104
exten => _61290373820,1,Dial(sip/61290373820@3.9.121.89:50070,,Tto);  104
exten => _61290372195,1,Dial(sip/61290372195@3.9.121.89:50070,,Tto);  104


;exten => _18064144838,1,Answer()
;exten => _1204607434,n,NoOP(PRI DID is Coming to the Server )
;exten => _18064144838,n,Playback(tt-monkeys)
;exten => _18064144838,n,MusiconHold()



 
exten => _18064144838,1,set(CALLERID(num)=DID-WWW-${CALLERID(num)})
exten => _18064144838,n,Playback(tt-monkeys)
exten => _18064144838,n,Goto(DID-CALLING,${EXTEN},1)
;exten => _6531582096,1,set(CALLERID(num)=Sandeep-Team-${CALLERID(num)})
;exten => _6531582096,n,Playback(tt-monkeys)
;exten => _6531582096,n,Goto(DID-CALLING,${EXTEN},1)

;exten => _61251335879,1,set(CALLERID(num)=JeevachExt-${CALLERID(num)})
;exten => _61251335879,n,Goto(DID-CALLING,${EXTEN},1)


;exten => _61871705097,1,set(CALLERID(num)=WineEXT-${CALLERID(num)})
;exten => _61871705097,n,Goto(DID-CALLING,${EXTEN},1)

;exten => _61383623791,1,set(CALLERID(num)=WineWebsite-${CALLERID(num)})
;exten => _61383623791,n,Goto(DID-CALLING,${EXTEN},1)


;exten => _61383623792,1,set(CALLERID(num)=WineWebsite-${CALLERID(num)})
;exten => _61383623792,n,Goto(DID-CALLING,${EXTEN},1)

;exten => _1204607434,1,Answer()
;exten => _1204607434,n,MusiconHold()
;exten => _1204607434,n,Hangup()






exten => _X.,1,goto(DID-CALLING,${EXTEN},1)
exten => _+X.,1,goto(DID-TWILIO,${EXTEN},1)
;exten => _+X.,1,goto(test-did,${EXTEN:1},1)

;exten => _", "ext_status=0") in new stack
;exten => _1204607434,1,Answer()
;exten => _1204607434,n,MusiconHold()
;exten => _1204607434,n,Hangup()
[test-did]
exten => _X.,1,Answer()
exten => _X.,n,MusiconHold()
exten => _X.,n,Hangup()

;exten => _1204607434,1,Answer()
;exten => _1204607434,n,MusiconHold()
;exten => _1204607434,n,Hangup()


[DID-TWILIO]
exten => _+X.,1,NoOp((NOTICE, Call Group All did-selection context)...................../r/n)
same=>n,Set(i=1)
same=>n,Agi(SSagi/pathfinder.php,${did},${EXTEN},didtype)
same=>n,NoOp((NOTICE, CONTINUE : ${continue})...................../r/n)
same=>n,GotoIf($["${continue}" = "1"]?call-queue)
same=>n,GotoIf($["${continue}" = "2"]?va-Celular)
same=>n,GotoIf($["${continue}" = "9"]?call-reject)
same=>n,Set(i=$[${i}+1])
same=>n,EndWhile
same=>n(call-queue),Goto(twilio-menu,${EXTEN},1)
same=>n,Hangup()
same=>n(va-Celular),Goto(twilio-menu,${EXTEN},1)
same=>n,Hangup()
same=>n(call-reject),Goto(call-reject,${EXTEN},1)
same=>n,Hangup()

[twilio-menu]
exten => _+X.,1,NoOp((NOTICE, GO TO CALL QUEUE)...................../r/n)
exten => _+X.,n,Set(CDR(call_type)=1)
exten => _+X.,n,Verbose(SIPHEADER ${SIP_HEADER(TO)})
exten => _+X.,n,Verbose(SIPHEADER ${SIP_HEADER(FROM)})
exten => _+X.,n,Verbose( X extensions)
exten => _+X.,n,Set(CDR(did)=${CALLERID(dnid):-11})
exten => _+X.,n,Set(__global_did=${CALLERID(dnid):-11})
exten => _+X.,n,Set(callerblacklist=${GENERIC_WORX(select id from cc_blacklist where caller_id=${CALLERID(num):-10})})
exten => _+X.,n,Set(CDR(cnum)=0.02)
exten => _+X.,n,Set(CDR(outbond_cnum)="WELCO")
exten => _+X.,n,GoToIf($["${callerblacklist}" != ""]?finish)
exten => _+X.,n(checkdnid),GotoIf($["${CALLERID(dnid):-11})}" = ""]?setdnid:start)
exten => _+X.,n(setdnid),Set(CALLERID(dnid)=${EXTEN})
exten => _+X.,n(start),Set(__iduser=${GENERIC_WORX(select iduser from cc_did where did=${CALLERID(dnid):-11})})
exten => _+X.,n,Set(CDR(iduser)=${iduser})
exten => _+X.,n(start),Set(__cost=${GENERIC_WORX(select aleg_retail_cost_min from cc_did where did=${CALLERID(dnid):-11})})
exten => _+X.,n,Set(CDR(cost)=${cost})
exten => _+X.,n,Set(__result=${GENERIC_WORX(select destination_name did from cc_did_destination LEFT JOIN cc_did ON cc_did_destination.id_cc_did=cc_did.id where did=${CALLERID(dnid):-11})})
exten => _+X.,n,GotoIf($["${result}" = ""]?finish)
exten => _+X.,n,Set(__result1=${GENERIC_WORX(select destination did from cc_did_destination LEFT JOIN cc_did ON cc_did_destination.id_cc_did=cc_did.id where did=${CALLERID(dnid):-11})})
exten => _+X.,n,Set(__priority=${GENERIC_WORX(select priority did from cc_did_destination LEFT JOIN cc_did ON cc_did_destination.id_cc_did=cc_did.id where did=${CALLERID(dnid):-11})})
exten => _+X.,n,GoSub(did-ivr,s,1)
exten => _+X.,n(routing),GotoIf($["${result1}" = ""]?finish)
;exten => _X.,n,GotoIf($[${result1} = 80001]?gethit,1)
exten => _+X.,n,GotoIf($[${result1} = 505]?ivr,1)
exten => _+X.,n,GotoIf($["${result}" = "Queues"]?enter-queues,${EXTEN},1)
exten => _+X.,n,GotoIf($["${result}" = "VM"]?didvmmain,${EXTEN},1)
exten => _+X.,n,GotoIf($["${result}" = "Extensions"]?PRI-to-extensions,${EXTEN},1)
exten => _+X.,n,GotoIf($["${result}" = "External"]?External-TFN,${EXTEN},1)
exten => _+X.,n,GotoIf($["${result}" = ""]?finish:finish)
exten => _+X.,n(finish),Hangup
exten => ivr,1,Read(ch,travomint/travomint_wel,1,,3,5)
exten => ivr,n,GoToIf($[${ch} = 1]?eng,1)
exten => ivr,n,GoToIf($[${ch} = 2]?hindi,1)
exten => ivr,n,GoTo(eng,1)
exten => eng,1,set(CALLERID(num)=Eng-${CALLERID(num)})
exten => eng,n,set(home=travomint/english)
exten => eng,n,GoTo(main,1)
exten => hindi,1,set(CALLERID(num)=hin-${CALLERID(num)})
exten => hindi,n,set(home=travomint/hindi)
exten => hindi,n,GoTo(main,1)
exten => main,1,Read(ch,${home}/travomintmain,1,,3,5)
exten => main,n,GoToIf($[${ch} = 1]?time,1)
exten => main,n,GoToIf($[${ch} = 2]?time,1)
exten => main,n,GoTo(time,1)
exten => time,1,GoTo(enter-queues,${EXTEN},1)
exten => gethit,1,Goto(gethits,${global_did},1)
exten => _X.,n(finish),Hangup

[PRI-to-extensions]
exten => _+X.,1,Progress()
exten => _+X.,n,Set(CDR(dest_name)=inbound)
exten => _+X.,n(binternal),Set(CDR(extension)=${result1})
exten => _+X.,n,Set(tempo=${CUT(CHANNEL,/,2)})
exten => _+X.,n,Set(extension=${CUT(tempo,-,1)})
exten => _+X.,n,Set(CALLERID(num)=${global_clin})
exten => _+X.,n,Set(iduser=${GENERIC_WORX(SELECT `id_cc_card` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _+X.,n,Set(CDR(user_id)=${iduser})
exten => _+X.,n,Set(__destination=${GENERIC_WORX(select queue_name from cc_queue_member_table where membername=${result1})})
exten => _+X.,n,Set(CDR(dest_name)=${destination})
exten => _+X.,n,Set(CALLERID(num)=${CALLERID(num)}-for-${GENERIC_WORX(SELECT `agent_name` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _+X.,n,Set(agentName=${GENERIC_WORX(SELECT `agent_name` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _+X.,n,Set(CDR(call_type)=1)
exten => _+X.,n,Set(dial_out=${GENERIC_WORX(SELECT `dial_timeout` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _+X.,n,Set(callstatus=Inbound)
exten => _+X.,n,Set(dialnum=${result1})
exten => _+X.,n,Set(CDR(extension)=${extension})
exten => _+X.,n,Set(MONITOR_FILENAME=IN-${UNIQUEID}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)})
exten => _+X.,n,MixMonitor(${MONITOR_FILENAME}.wav,bi(mixmvar))
exten => _+X.,n,Set(mydid=${CALLERID(dnid)})
exten => _+X.,n,Set(CDR(DID)=${CALLERID(dnid)})
exten => _+X.,n,Set(CDR(Recordings)=${MONITOR_FILENAME}.wav)
exten => _+X.,n,Set(ext_status=${GENERIC_WORX(SELECT `paused` FROM `cc_queue_member_table` WHERE `queue_name` =${destination} AND `membername` = ${result1})})

exten => _+X.,n(action),GotoIf($["${ext_status}" = "1"]?exit:)
exten => _+X.,n,GoSub(exten-ivr,s,1)
exten => _+X.,n,GoSub(live_call,1)
exten => _+X.,n,Dial(SIP/${result1},${dial_out},U(ext_ans,${UNIQUEID}^${result1}))
exten => _+X.,n,StopMixMonitor(${mixmvar})
exten => _+X.,n,NoOp(Dial Status:: ${DIALSTATUS})
exten => _+X.,n,Goto(s-${DIALSTATUS},1)
exten => _+X.,n,Set(extenfail=${GENERIC_WORX(SELECT `fail_status` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _+X.,n,GotoIf($["${extenfail}" = "Y"]?:finish_extension)
exten => _+X.,n,Verbose( call is terminated)
exten => _+X.,n,Set(__result=${GENERIC_WORX(SELECT `fail_dest` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _+X.,n,GotoIf($["${result}" = ""]?finish_extension)
exten => _+X.,n,Set(__result1=${GENERIC_WORX(SELECT `fail_data` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _+X.,n,GotoIf($["${result1}" = ""]?exit:jumping-priority,${global_did},1)
exten => _+X.,n(exit),Hangup()
exten => live_call,1,Set(WP_LC_BEGIN(${iduser},${UNIQUEID},${mydid},${global_clin},${destination},${callstatus},2,${dialnum},${CHANNEL})=)
exten => live_call,n,Set(__lc_id=${WP_LC_BEGIN(${iduser},${UNIQUEID},${mydid},${global_clin},${destination},${callstatus},2,${dialnum},${CHANNEL})})
exten => live_call,n,Return
exten => s-NOANSWER,1,Goto(jumping-priority,${global_did},1)
;exten => s-NOANSWER,1,Goto(extvmmain,${result1},1)
exten => s-BUSY,1,Goto(jumping-priority,${global_did},1)
;exten => s-BUSY,1,Goto(extvmmain,${result1},1)
exten => s-ANSWER,1,Goto(finish_extension)
exten => s-CONGESTION,1,Goto(jumping-priority,${global_did},1)
exten => s-CANCEL,1,Hangup
exten => s-CHANUNAVAIL,1,Goto(jumping-priority,${global_did},1)
exten => finish_extension,1,Hangup
exten => h,1,ExecIf($[${lc_id} != ""]?Set(WP_LC_END(`id`)=${lc_id}))
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 2)})
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 3)})
exten => h,n,NoOp()




[ssss]
exten => _X.,1,NoOp(${CALLERID(all)})
exten => _X.,n,GotoIf($["${CALLERID(num):0:1}" = "+"]?remove:OK)
exten => _X.,n(remove),Set(num=${CALLERID(num):1})
exten => _X.,n(OK),Set(num=${CALLERID(num)})
exten => _X.,n,GotoIf($[${ISNULL(${CALLERID(ani)})}=1]?NULL)
exten => _X.,n,GotoIf($[${LEN(${CALLERID(num)})}<3]?NULL)
exten => _X.,n,Set(isnumber=${REGEX("[0-9]" ${CALLERID(num)})})
exten => _X.,n,GotoIf($["${isnumber}" = "1"]?PASS:NULL)
exten => _X.,n(PASS),Goto(DID-CALLING,${EXTEN},1)
exten => _X.,n(NULL),Hangup()

[DID-CALLING]
;exten => _+X.,1,NoOp((NOTICE, Call Group All did-selection context)...................../r/n)
exten => _X.,1,NoOp((NOTICE, Call Group All did-selection context)...................../r/n)
same=>n,Set(i=1)
same=>n,Agi(SSagi/pathfinder.php,${did},${EXTEN},didtype)
same=>n,NoOp((NOTICE, CONTINUE : ${continue})...................../r/n)
same=>n,GotoIf($["${continue}" = "1"]?call-queue)
same=>n,GotoIf($["${continue}" = "2"]?va-Celular)
same=>n,GotoIf($["${continue}" = "9"]?call-reject)
same=>n,Set(i=$[${i}+1])
same=>n,EndWhile
same=>n(call-queue),Goto(main-menu,${EXTEN},1)
same=>n,Hangup()
same=>n(va-Celular),Goto(main-menu,${EXTEN},1)
same=>n,Hangup()
same=>n(call-reject),Goto(call-reject,${EXTEN},1)
same=>n,Hangup()

[call-reject]
exten => _X.,1,NoOp((NOTICE, Call Group All in Ring-Group context)...................../r/n)
same=> n,Hangup()


[jump-queues]
exten => _X.,1,Answer
exten => _X.,n,Set(callstatus=Inbound)
exten => _X.,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 2)})
exten => _X.,n,Set(MONITOR_FILENAME=IN-${UNIQUEID}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)})
exten => _X.,n,MixMonitor(${MONITOR_FILENAME}.wav,b)
exten => _X.,n,Set(CDR(Recordings)=${MONITOR_FILENAME}.wav)
exten => _X.,n,Set(CDR(dest_name)=${result1})
exten => _X.,n,Set(time_out=${GENERIC_WORX(SELECT `queue_timeout` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,GoSub(live_call,1)
exten => _X.,n,Gosub(position-gosub,s,1(${priority},${result1},${global_did}))
exten => _X.,n(jump2queue),Queue(${result1},twW,,,${time_out},,,my-announcement,,${GOSUB_RETVAL})
exten => _X.,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 2)})
exten => _X.,n,Verbose( queuestatus is ${QUEUESTATUS} )
exten => _X.,n,GotoIf([$["${QUEUESTATUS}" = "TIMEOUT"]|$["${QUEUESTATUS}" = "JOINEMPTY"]]?:finish_queue)
exten => _X.,n,Set(qfail=${GENERIC_WORX(SELECT `fail_status` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${qfail}" = "Y"]?:finish_queue)
exten => _X.,n,Set(__result=${GENERIC_WORX(SELECT `fail_dest` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${result}" = ""]?finish_queue)
exten => _X.,n,Set(__result1=${GENERIC_WORX(SELECT `fail_data` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${result1}" = ""]?finish_queue:jumping,${EXTEN},start)
exten => _X.,n(finish_queue),Hangup
exten => live_call,1,Set(WP_LC_BEGIN(${userid},${UNIQUEID},${global_did},${global_clin},${result1},${callstatus},1,NULL,${CHANNEL})=)
exten => live_call,n,Set(__lc_id=${WP_LC_BEGIN(${userid},${UNIQUEID},${global_did},${global_clin},${result1},${callstatus},1,NULL,${CHANNEL})})
exten => live_call,n,Return()
exten => h,1,ExecIf($[${lc_id} != ""]?Set(WP_LC_END(`id`)=${lc_id}))
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 2)})
exten => h,n,NoOp()



[MusiconHold]
exten => s,1,NoOP()
same=> n,MusicOnHold();
same=> n,Return()


[main-menu]
exten => _X.,1,NoOp((NOTICE, GO TO CALL QUEUE)...................../r/n)
exten => _X.,n,Set(CDR(call_type)=1)
exten => _X.,n,Verbose(SIPHEADER ${SIP_HEADER(TO)})
exten => _X.,n,Verbose(SIPHEADER ${SIP_HEADER(FROM)})
exten => _X.,n,Verbose( X extensions)
exten => _X.,n,Set(__START=${CDR(starttime)})
exten => _X.,n,Set(__global_did=${CALLERID(dnid)})
exten => _X.,n,Set(CONNECTEDLINE(num,i)=${global_did})
exten => _X.,n,Set(__global_clin=${CALLERID(num)})
exten => _X.,n,Set(callerblacklist=${GENERIC_WORX(select id from cc_blacklist where caller_id=${CALLERID(num):-10})})
exten => _X.,n,GoToIf($["${callerblacklist}" != ""]?callend:start)
exten => _X.,n,Set(__iduser=${GENERIC_WORX(select iduser from cc_did where did=${CALLERID(dnid)})})
exten => _X.,n,GotoIf($["${iduser}" = ""]?callend:start)
exten => _X.,n(start),NoOp(<<============USER ID = ${iduser}=============>>)
exten => _X.,n,Set(CDR(user_id)=${iduser})
exten => _X.,n,Set(__result=${GENERIC_WORX(select destination_name did from cc_did_destination LEFT JOIN cc_did ON cc_did_destination.id_cc_did=cc_did.id where did=${CALLERID(dnid)})})
exten => _X.,n,Set(__result1=${GENERIC_WORX(select destination did from cc_did_destination LEFT JOIN cc_did ON cc_did_destination.id_cc_did=cc_did.id where did=${CALLERID(dnid)})})
exten => _X.,n,Set(__priority=${GENERIC_WORX(select priority did from cc_did_destination LEFT JOIN cc_did ON cc_did_destination.id_cc_did=cc_did.id where did=${CALLERID(dnid)})})
exten => _X.,n,GotoIf($["${result1}" = ""]?callend:routing)
exten => _X.,n,Hangup(<<===========No route hangup==========>>)
exten => _X.,n(routing),NoOp(<<============ROUTING = ${routing}=============>>)
exten => _X.,n,GotoIf($["${result}" = "Queues"]?enter-queues,${EXTEN},1)
exten => _X.,n,GotoIf($["${result}" = "VM"]?didvmmain,${EXTEN},1)
exten => _X.,n,GotoIf($["${result}" = "Extensions"]?calls-to-extensions,${EXTEN},1)
exten => _X.,n,GotoIf($["${result}" = "External"]?External-TFN,${EXTEN},1)
exten => _X.,n(callend),Hangup(<<===========No route hangup==========>>)
;;; IVR PLAYED
exten => english-context,1,Read(ch,custom/eng_seconf_ivr-2,1,,2,5)
exten => english-context,n,GoToIf($[${ch} = 1]?ENG1-start,1)
exten => english-context,n,GoToIf($[${ch} = 2]?ENG2-start,1)
exten => english-context,n,GoToIf($[${ch} = 3]?ENG3-start,1)
exten => english-context,n,GoToIf($[${ch} = 4]?ENG4-start,1)
exten => english-context,n,GoToIf($[${ch} = 5]?english-context,1)
exten => english-context,n,GoToIf($[${ch} = 6]?english-context,1)
exten => english-context,n,GoToIf($[${ch} = 7]?english-context,1)
exten => english-context,n,GoToIf($[${ch} = 8]?english-context,1)
exten => english-context,n,GoToIf($[${ch} = 9]?english-context,1)
exten => english-context,n,GoToIf($[${ch} = 0]?english-context,1)
exten => english-context,n(end),Playback(goodbye)
exten => english-context,n,Hangup()
;; Enlish Ivr Playing Here
exten => ENG1-start,1,NoOP(ENG QUEUE:: START HERE)
exten => ENG1-start,n,set(CALLERID(num)=Tmint-ENG-reservations-${CALLERID(num)})
exten => ENG1-start,n,GoTo(eng-queues,${global_did},1)
exten => ENG2-start,1,NoOP(ENG QUEUE:: START HERE)
exten => ENG2-start,n,set(CALLERID(num)=Tmint-ENG-flight-booking-${CALLERID(num)})
exten => ENG2-start,n,GoTo(eng-queues,${global_did},1)
exten => ENG3-start,1,NoOP(ENG QUEUE:: START HERE)
exten => ENG3-start,n,set(CALLERID(num)=Tmint-ENG-hotel-car-rental-vacations-transfer-${CALLERID(num)})
exten => ENG3-start,n,GoTo(eng-queues,${global_did},1)
exten => ENG4-start,1,NoOP(ENG QUEUE:: START HERE)
exten => ENG4-start,n,set(CALLERID(num)=Tmint-ENG-refunds-baggage-seats-otherservices-${CALLERID(num)})
exten => ENG4-start,n,GoTo(eng-queues,${global_did},1)

;; Spanish Ivr Playing Here
exten => spanish-context,1,Read(ch,custom/span_second_ivr_male-2,1,,2,5)
exten => spanish-context,n,GoToIf($[${ch} = 1]?SPAN1-start,1)
exten => spanish-context,n,GoToIf($[${ch} = 2]?SPAN2-start,1)
exten => spanish-context,n,GoToIf($[${ch} = 3]?SPAN3-start,1)
exten => spanish-context,n,GoToIf($[${ch} = 4]?SPAN4-start,1)
exten => spanish-context,n,GoToIf($[${ch} = 5]?spanish-context,1)
exten => spanish-context,n,GoToIf($[${ch} = 6]?spanish-context,1)
exten => spanish-context,n,GoToIf($[${ch} = 7]?spanish-context,1)
exten => spanish-context,n,GoToIf($[${ch} = 8]?spanish-context,1)
exten => spanish-context,n,GoToIf($[${ch} = 9]?spanish-context,1)
exten => spanish-context,n,GoToIf($[${ch} = 0]?spanish-context,1)
exten => spanish-context,n(end),Playback(goodbye)
exten => spanish-context,n,Hangup()
exten => SPAN1-start,1,NoOP(SPANISH QUEUE:: START HERE)
exten => SPAN1-start,n,set(CALLERID(num)=Tmint-SPAN-reservations-${CALLERID(num)})
exten => SPAN1-start,n,GoTo(span-queues,${global_did},1)
exten => SPAN2-start,1,NoOP(SPANISH QUEUE:: START HERE)
exten => SPAN2-start,n,set(CALLERID(num)=Tmint-SPAN-flight-booking-${CALLERID(num)})
exten => SPAN2-start,n,GoTo(span-queues,${global_did},1)
exten => SPAN3-start,1,NoOP(SPANISH QUEUE:: START HERE)
exten => SPAN3-start,n,set(CALLERID(num)=Tmint-SPAN-hotel-car-rental-vacations-transfer-${CALLERID(num)})
exten => SPAN3-start,n,GoTo(span-queues,${global_did},1)
exten => SPAN4-start,1,NoOP(SPANISH QUEUE:: START HERE)
exten => SPAN4-start,n,set(CALLERID(num)=Tmint-SPAN-refunds-baggage-seats-otherservices-${CALLERID(num)})
exten => SPAN4-start,n,GoTo(span-queues,${global_did},1)




[main-ivr-test]
exten =>_X.,1,NoOP("NEW EXTENSION")
same=>n,Set(INVALID=0)
same=>n,Set(TIMEOUT=0)
same=>n,agi(SSagi/googletts.agi, "Welcome to IVRS, Please Chose Options")
same=>n(start),agi(myagi/googletts.agi, "Press 1 to call user 1")
same=>n,agi(SSagi/googletts.agi, "Press 2 to call user 2")
same=>n,WaitExten(2)
exten=>1,1,NoOP("EXTEN 1")
same=>n,Goto(ivr-1,s,1)
exten=>2,1,NoOP("EXTEN 2")
same=>n,Goto(ivr-2,s,1)

exten => i,1,NoOP("INVALID CASE")
same=>n,Set(INVALID=$[${INVALID}+1])
same=>n,Gotoif($["${INVALID}" < "2"]?:end)
same=>n,agi(SSagi/googletts.agi,"you choose an invalid option. please try again",en)
same=>n,goto(main-ivr-test,${EXTEN},1)
same=>n(end),agi(SSagi/googletts.agi,"Number of attempts exceeded",en)
same=>n,Hangup

exten=>t,1,NoOP("TIMEOUT CASE")
same=>n,Set(TIMEOUT=$[${TIMEOUT}+1])
same=>n,Gotoif($["${TIMEOUT}" < "2"]?1000,start)
same=>n,agi(SSagi/googletts.agi,"Time out Exceeded",en)
same=>n,hangup

[ivr-1]
exten => s,1,NoOP("Calling is coming on Extension number 1")
same=> n,agi(SSagi/googletts.agi,"Sorry user 1 is not available in the moment please call try again, good bye ",en)

[ivr-2]
exten =>s,1,NoOP("Calling is coming on Extension number 2")
same=> n,agi(SSagi/googletts.agi,"Sorry user 2 is not available in the moment please call try again, good bye ",en)





[jumping-extension]
exten => _X.,1,Set(CDR(extension)=${result1})
exten => _X.,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 2)})
exten => _X.,n,Set(destination=${GENERIC_WORX(select queue_name from cc_queue_member_table where membername=${result1})})
exten => _X.,n,Set(CDR(dest_name)=${destination})
exten => _X.,n,Set(out_cli=${GENERIC_WORX(SELECT `callerid` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,Set(agentName=${GENERIC_WORX(SELECT `agent_name` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,Set(dial_out=${GENERIC_WORX(SELECT `dial_timeout` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,Set(callstatus=Inbound)
exten => _X.,n,Set(dialnum=${global_did})
exten => _X.,n,Set(CALLERID(num)=${out_cli})
exten => _X.,n,Set(MONITOR_FILENAME=IN-${UNIQUEID}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)})
exten => _X.,n,MixMonitor(${MONITOR_FILENAME}.wav,bi(mixmvar))
exten => _X.,n,Set(CDR(DID)=${CALLERID(dnid)})
exten => _X.,n,Set(CDR(Recordings)=${MONITOR_FILENAME}.wav)
;exten => _X.,n,Set(ext_status=${GENERIC_WORX(SELECT `paused` FROM `cc_queue_member_table` WHERE `queue_name` =${destination} AND `membername` = ${result1})})
exten => _X.,n(action),GotoIf($["${ext_status}" = "1"]?exit:)
exten => _X.,n,GoSub(live_call,1)
exten => _X.,n,Dial(SIP/${result1},${dial_out},U(ext_ans,${UNIQUEID}^${result1}))
exten => _X.,n,StopMixMonitor(${mixmvar})
exten => _X.,n,NoOp(dialstatus :: ${DIALSTATUS})
exten => _X.,n,VoiceMail(${EXTEN}@default)
exten => _X.,n,Verbose(  dialstatus is ${DIALSTATUS} CHANUNAVAIL )
exten => _X.,n,GotoIf([$["${DIALSTATUS}" = "CHANUNAVAIL"]|$["${DIALSTATUS}" = "NOANSWER"]]?:finish_extension)
;exten => _X.,n,GotoIf([$["${DIALSTATUS}" = "CHANUNAVAIL"]|$["${DIALSTATUS}" = "NOANSWER"]]?:finish_extension)
exten => _X.,n,Set(extenfail=${GENERIC_WORX(SELECT `fail_status` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${extenfail}" = "Y"]?:finish_extension)
exten => _X.,n,Verbose( call is terminated)
exten => _X.,n,Set(__result=${GENERIC_WORX(SELECT `fail_dest` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${result}" = ""]?finish_extension)
exten => _X.,n,Set(__result1=${GENERIC_WORX(SELECT `fail_data` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${result1}" = ""]?finish_extension:devices,${EXTEN},routing)
exten => _X.,n(finish_extension),Hangup
;exten => _X.,n(exit),Goto(vmmain,${global_did},1)
exten => live_call,1,Set(WP_LC_BEGIN(${iduser},${UNIQUEID},${dialnum},${out_cli},${destination},${callstatus},2,${dialnum},${CHANNEL})=)
exten => live_call,n,Set(__lc_id=${WP_LC_BEGIN(${iduser},${UNIQUEID},${dialnum},${dialnum},${destination},${callstatus},2,${dialnum},${CHANNEL})})
exten => live_call,n,Return
exten => h,1,ExecIf($[${lc_id} != ""]?Set(WP_LC_END(`id`)=${lc_id}))
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 2)})
exten => h,n,NoOp()

[jumping-priority]
exten => _X.,1,GoTo(switchcall,1)
exten => switchcall,1,NoOp((NOTICE, GO TO CALL QUEUE)...................../r/n)
exten => switchcall,n,playback(prepaid-callfollowme)
exten => switchcall,n,Set(priority=$[${priority}+1])
exten => switchcall,n,NoOp(${priority})
exten => switchcall,n,Set(CDR(call_type)=1)
exten => switchcall,n,Verbose(SIPHEADER ${SIP_HEADER(TO)})
exten => switchcall,n,Verbose(SIPHEADER ${SIP_HEADER(FROM)})
exten => switchcall,n,Verbose( X extensions)
exten => switchcall,n,Set(CDR(did)=${CALLERID(dnid)})
exten => switchcall,n,Set(__global_did=${CALLERID(dnid)})
exten => switchcall,n,Set(CONNECTEDLINE(num,i)=${global_did})
exten => switchcall,n,Set(__global_clin=${CALLERID(num)})
exten => switchcall,n,Set(callerblacklist=${GENERIC_WORX(select id from cc_blacklist where caller_id=${CALLERID(num):-10})})
exten => switchcall,n,GoToIf($["${callerblacklist}" != ""]?finish)
exten => switchcall,n(checkdnid),GotoIf($["${CALLERID(dnid)})}" = ""]?setdnid:start)
exten => switchcall,n(setdnid),Set(CALLERID(dnid)=${EXTEN})
exten => switchcall,n(start),Set(iduser=${GENERIC_WORX(select iduser from cc_did where did=${CALLERID(dnid)})})
exten => switchcall,n,Set(CDR(iduser)=${iduser})
exten => switchcall,n,Set(__result=${GENERIC_WORX(select destination_name did from cc_did_destination LEFT JOIN cc_did ON cc_did_destination.id_cc_did=cc_did.id where did=${CALLERID(dnid)} AND priority=${priority})})
exten => switchcall,n,Set(__result1=${GENERIC_WORX(select destination did from cc_did_destination LEFT JOIN cc_did ON cc_did_destination.id_cc_did=cc_did.id where did=${CALLERID(dnid)} AND priority=${priority})})
exten => switchcall,n(start),GotoIf($["${result1}" = ""]?finish)
exten => switchcall,n,GotoIf($["${result}" = "Queues"]?jump-queues,${result1},1)
exten => switchcall,n,GotoIf($["${result}" = "Extensions"]?jumping-extension,${global_did},1)
;exten => switchcall,n,GotoIf($["${result}" = "External"]?jumping-OutBond-Calls,${result1},1)
exten => switchcall,n,GotoIf($["${result}" = "External"]?Forward-TFN,${global_did},1)
exten => switchcall,n,GotoIf($["${result}" = "VM"]?vmmain,${result1},1)
exten => switchcall,n,GotoIf($["${result}" = ""]?finish:finish)
exten => switchcall,n(finish),Hangup
exten => h,1,ExecIf($[${lc_id} != ""]?Set(WP_LC_END(`id`)=${lc_id}))
exten => h,n,NoOp()

[enter-queues]
;01 => INB
exten => 01,1,GoSub(queue-status,${agentext},1(INBOUND))
;02 => OUTB
exten => 02,1,GoSub(queue-status,${agentext},1(OUTBOUND))
;03 => BREAK
exten => 03,1,GoSub(queue-status,${agentext},1(PAUSED))
;04 => LOGOUT
exten => 04,1,GoSub(queue-status,${agentext},1(LOGOUT))
exten => _X.,1,Progress()
exten => _X.,n,Set(callstatus=Inbound)
exten => _X.,n,GoSubIf($[${result1} = 8801]?checktime,1)
exten => _X.,n,GoSub(live_call,1)
exten => _X.,n,Set(qtime_wait=${GENERIC_WORX(UPDATE cc_live_calls Set status = 2 WHERE id = ${lc_id})})
exten => _X.,n,Set(MONITOR_FILENAME=IN-${UNIQUEID}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)})
exten => _X.,n,MixMonitor(${MONITOR_FILENAME}.wav,b)
exten => _X.,n,Set(CDR(Recordings)=${MONITOR_FILENAME}.wav)
exten => _X.,n,Set(CDR(dest_name)=${result1})
exten => _X.,n,Set(__agentext=${GENERIC_WORX(SELECT `membername` FROM `cc_queue_member_table` WHERE `queue_name`= ${result1})})
exten => _X.,n,NoOP(${agentext})
exten => _X.,n,Set(qtime_out=${GENERIC_WORX(SELECT `timeout` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,Set(findpriority=${GENERIC_WORX(select priority did from cc_did_destination LEFT JOIN cc_did ON cc_did_destination.id_cc_did=cc_did.id where did=${CALLERID(dnid)})})
exten => _X.,n,GotoIf($[$["${findpriority}" != ""] & $["${findpriority}" > "0"]]?:jump2queue)
exten => _X.,n,Gosub(queues-ivr,s,1)
exten => _X.,n,Gosub(position-find,s,1(${findpriority},${result1},${global_did}))
exten => _X.,n(jump2queue),Queue(${result1},twW,,,${qtime_out},,,test-announcement,,${GOSUB_RETVAL})
;exten => _X.,n(jump2queue),Queue(${result1},HhTtKkWw,,,${qtime_out},,,test-announcement,,${GOSUB_RETVAL})
;exten => _X.,n(jump2queue),Queue(${result1},${qtime_out},twWU(SETBUSY)B(SETRINGING^1^1)))
exten => _X.,n,Verbose(  queuestatus is ${QUEUESTATUS} )
exten => _X.,n,GotoIf($[${QUEUESTATUS}" = "TIMEOUT"]?jumping-priority,${global_did},1:finish_queue)
exten => _X.,n,GotoIf($[${QUEUESTATUS}" = "JOINEMPTY"]?jumping-priority,${global_did},1:finish_queue)
;exten => _X.,n,GotoIf([$["${QUEUESTATUS}" = "TIMEOUT"]|$["${QUEUESTATUS}" = "JOINEMPTY"]]?:finish_queue)
exten => _X.,n,Set(qfail=${GENERIC_WORX(SELECT `fail_status` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${qfail}" = "Y"]?:finish_queue)
exten => _X.,n,Set(__result=${GENERIC_WORX(SELECT `fail_dest` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${result}" = ""]?finish_queue)
exten => _X.,n,Set(__result1=${GENERIC_WORX(SELECT `fail_data` FROM `cc_queue_table` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${result1}" = ""]?finish_queue:jumping-priority,switchcall,start)
exten => _X.,n(finish_queue),Hangup
exten => checktime,1,GoToIfTime(08:30-11:30,*,*,*?hang)
exten => checktime,n,return
exten => checktime,n(hang),HangUp
exten => live_call,1,Set(WP_LC_BEGIN(${userid},${UNIQUEID},${global_did},${global_clin},${result1},${callstatus},1,NULL,${CHANNEL})=)
exten => live_call,n,Set(__lc_id=${WP_LC_BEGIN(${userid},${UNIQUEID},${global_did},${global_clin},${result1},${callstatus},1,NULL,${CHANNEL})})
exten => live_call,n,Return()
exten => h,1,NoOp()
exten => h,n,ExecIf($[${lc_id} != ""]?Set(WP_LC_END(`id`)=${lc_id}))
include => set-callback

[set-callback]
exten => 1,1,NoOp('-------------------- ${CALLERID(num)} PRESS BUTTON ${EXTEN}. ALLOW_CALLBACK=${ALLOW_CALLBACK}')
same=> n,Queue(0002,twW,,,${qtime_out},,,test-announcement,,${GOSUB_RETVAL})

[Callback-Context]
exten => _X.,1,Progress()
exten => _X.,n,Set(tempo=${CUT(CHANNEL,/,2)})
exten => _X.,n,Set(EXTEN=${CUT(tempo,-,1)})
exten => _X.,n,Playback(AgentIVR)
exten => _X.,n,Agi(SSagi/callback_msg.php,${PHONESTATUS});
exten => _X.,n,Agi(SSagi/googletts.agi,"The issue reported by customer is,! ${MESSAGE}",en);
exten => _X.,n,Agi(SSagi/get_cbid.php,${CALLNO}
exten => _X.,n,NoOP(${CBID})
exten => _X.,n,Set(__RR=${GENERIC_WORX(SELECT `report` FROM `cc_callback_request` WHERE `id`= ${CBID})})
exten => _X.,n,Set(__out_cli=${GENERIC_WORX(SELECT `channel` FROM `cc_callback_request` WHERE `id`= ${CBID})})
exten => _X.,n,Set(__dialnum=${GENERIC_WORX(SELECT `exten` FROM `cc_callback_request` WHERE `id`= ${CBID})})
exten => _X.,n,Set(__myid=${GENERIC_WORX(SELECT `id` FROM `cc_callback_request` WHERE `id`= ${CBID})})
exten => _X.,n,Set(callstatus=Callback)
exten => _X.,n,Set(__EXTEN=${dialnum})
exten => _X.,n,NoOP(${EXTEN})
exten => _X.,n,Set(CALLERID(num)=${out_cli})
exten => _X.,n,Set(CDR(call_type)=2)
exten => _X.,n,Set(CDR(Recordings)=${UNIQUEID}.wav)
exten => _X.,n,GoSub(update_call,1)
exten => _X.,n,AGI(SSagi/worxdialer.php,3)
exten => update_call,1,Set(${GENERIC_WORX(UPDATE cc_callback_request SET call_id=3 WHERE status=1 and id =${CBID} LIMIT 1)})
exten => update_call,n,Return()
exten => _X.,n,Hangup
exten => h,1,MySQL(Connect connid localhost root tumko34h1se worxdialer)
exten => h,n,MYSQL(Query resultid ${connid} UPDATE cc_callback_request SET status=0 WHERE call_id=3 LIMIT 1)
exten => h,n,MYSQL(Clear ${resultid})
exten => h,n,MYSQL(Query resultid ${connid} UPDATE cc_callback_request SET call_id=1 WHERE call_id=3 LIMIT 1)
exten => h,n,MYSQL(Clear ${resultid})
exten => h,n,NoOp()

[DoCallback]
exten => _X.,1,NoOp((NOTICE, GO TO DoCallback ALL Fish Good)...................../r/n)
exten => _X.,n,Agi(SSagi/googletts.agi,"You are receiving this call as you requested callback with us,en);
exten => _X.,n,Playback(custom/callrecordingw)
exten => _X.,n,Set(CDR(call_type)=2)
exten => _X.,n,set(CALLERID(num)=${CALLERID(num)})
exten => _X.,n,Set(__callback_did=${GENERIC_WORX(select exten_num from site_exten_map where  exten_num=${EXTEN})})
exten => _X.,n,Set(CDR(did)=${EXTEN})
exten => _X.,n,Set(CONNECTEDLINE(num,i)=${callback_did})
exten => _X.,n,Set(__callback_clin=${CALLERID(num)})
exten => _X.,n,Set(callerblacklist=${GENERIC_WORX(select id from cc_blacklist where caller_id=${CALLERID(num):-10})})
exten => _X.,n,GoToIf($["${callerblacklist}" != ""]?finish)
exten => _X.,n(checkdnid),GotoIf($["${callback_did})}" = ""]?setdnid:start)
exten => _X.,n(setdnid),Set(${callback_did}=${EXTEN})
exten => _X.,n(start),Set(__sitename=${GENERIC_WORX(select site_id from site_exten_map where exten_num=${callback_did})})
exten => _X.,n,Set(__siteid=${GENERIC_WORX(select id from site_exten_map where exten_num=${callback_did})})
exten => _X.,n,Set(CDR(siteid)=${siteid})
exten => _X.,n,Set(CDR(sitename)=${sitename})
exten => _X.,n,Set(__result=${GENERIC_WORX(select destination_type from site_exten_map where exten_num=${callback_did})})
exten => _X.,n,Set(__result1=${GENERIC_WORX(SELECT local_queue FROM `site_exten_map` WHERE exten_num=${callback_did})})
exten => _X.,n,GotoIf($["${result}" = ""]?finish)
exten => _X.,n(routing),GotoIf($["${result1}" = ""]?finish)
exten => _X.,n,GotoIf($["${result}" = "Callback"]?enter-callback-system,${callback_did},1:finish)
exten => _X.,n,GotoIf($["${result}" = ""]?finish:finish)
exten => _X.,n(finish),Hangup



[my-announcement]
exten => s,1,NoOp()
same => n,Set(cut_channel=${CUT(CHANNEL,/,2)})
same => n,Set(cut_agent=${CUT(cut_channel,-,1)})
same => n,Set(CDR(extension)=${cut_agent})
same => n,Set(agent_name=${GENERIC_WORX(select agent_name from cc_sip_buddies where name = ${cut_agent})})
same => n,Set(DB(w2c_ext/${lc_id})=${cut_agent})
same => n,Set(DB(w2c_ext_name/${lc_id})=${agent_name})
same => n,Set(WP_LC_ANS(`agent_number`,`agent_name`,`call_status`,`id`,`status`,`modified`)=${cut_agent},${agent_name},Inbound(connected),${lc_id},3)
same => n,Set(voice=${GENERIC_WORX(select playback from cc_did where did=${global_did})})
same => n,GotoIf($["${voice}" = ""]?return:play)
same => n(play),Playback(${voice})
same => n(return),Return()

[call_ans]
exten => s,1,Set(cut_channel=${CUT(CHANNEL,/,2)})
exten => s,n,Set(cut_agent=${CUT(cut_channel,-,1)})
exten => s,n,Set(CDR(extension)=${cut_agent})
exten => s,n,Set(agent_name=${GENERIC_WORX(select agent_name from cc_sip_buddies where name = ${cut_agent})})
exten => s,n,Set(DB(w2c_ext/${lc_id})=${cut_agent})
exten => s,n,Set(DB(w2c_ext_name/${lc_id})=${agent_name})
exten => s,n,Set(WP_LC_ANS(`agent_number`,`agent_name`,`call_status`,`id`,`status`,`modified`)=${cut_agent},${agent_name},Outbound(connected),${lc_id},3)
exten => s,n,Return()



[calls-to-extensions]
exten => _X.,1,Progress()
exten => _X.,n,Set(CDR(dest_name)=inbound)
exten => _X.,n(binternal),Set(CDR(extension)=${result1})
exten => _X.,n,Set(tempo=${CUT(CHANNEL,/,2)})
exten => _X.,n,Set(extension=${CUT(tempo,-,1)})
exten => _X.,n,Set(CALLERID(num)=${global_clin})
exten => _X.,n,Set(iduser=${GENERIC_WORX(SELECT `id_cc_card` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,Set(CDR(user_id)=${iduser})
exten => _X.,n,Set(__destination=${GENERIC_WORX(select queue_name from cc_queue_member_table where membername=${result1})})
exten => _X.,n,Set(CDR(dest_name)=${destination})
exten => _X.,n,Set(CALLERID(num)=${CALLERID(num)}-for-${GENERIC_WORX(SELECT `agent_name` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,Set(agentName=${GENERIC_WORX(SELECT `agent_name` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,Set(CDR(call_type)=1)
exten => _X.,n,Set(dial_out=${GENERIC_WORX(SELECT `dial_timeout` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,Set(callstatus=Inbound)
exten => _X.,n,Set(dialnum=${result1})
exten => _X.,n,Set(CDR(extension)=${extension})
exten => _X.,n,Set(MONITOR_FILENAME=IN-${UNIQUEID}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)})
exten => _X.,n,MixMonitor(${MONITOR_FILENAME}.wav,bi(mixmvar))
exten => _X.,n,Set(mydid=${CALLERID(dnid)})
exten => _X.,n,Set(CDR(DID)=${CALLERID(dnid)})
exten => _X.,n,Set(CDR(Recordings)=${MONITOR_FILENAME}.wav)
exten => _X.,n,Set(ext_status=${GENERIC_WORX(SELECT `paused` FROM `cc_queue_member_table` WHERE `queue_name` =${destination} AND `membername` = ${result1})})
exten => _X.,n(action),GotoIf($["${ext_status}" = "1"]?exit:)
exten => _X.,n,GoSub(exten-ivr,s,1)
exten => _X.,n,GoSub(live_call,1)
exten => _X.,n,Dial(SIP/${result1},${dial_out},U(ext_ans,${UNIQUEID}^${result1}))
exten => _X.,n,StopMixMonitor(${mixmvar})
exten => _X.,n,NoOp(Dial Status:: ${DIALSTATUS})
exten => _X.,n,Goto(s-${DIALSTATUS},1)
exten => _X.,n,Set(extenfail=${GENERIC_WORX(SELECT `fail_status` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${extenfail}" = "Y"]?:finish_extension)
exten => _X.,n,Verbose( call is terminated)
exten => _X.,n,Set(__result=${GENERIC_WORX(SELECT `fail_dest` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${result}" = ""]?finish_extension)
exten => _X.,n,Set(__result1=${GENERIC_WORX(SELECT `fail_data` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${result1}" = ""]?exit:jumping-priority,${global_did},1)
exten => _X.,n(exit),Hangup()
exten => live_call,1,Set(WP_LC_BEGIN(${iduser},${UNIQUEID},${mydid},${global_clin},${destination},${callstatus},2,${dialnum},${CHANNEL})=)
exten => live_call,n,Set(__lc_id=${WP_LC_BEGIN(${iduser},${UNIQUEID},${mydid},${global_clin},${destination},${callstatus},2,${dialnum},${CHANNEL})})
exten => live_call,n,Return
exten => s-NOANSWER,1,Goto(jumping-priority,${global_did},1)
;exten => s-NOANSWER,1,Goto(extvmmain,${result1},1)
exten => s-BUSY,1,Goto(jumping-priority,${global_did},1)
;exten => s-BUSY,1,Goto(extvmmain,${result1},1)
exten => s-ANSWER,1,Goto(finish_extension)
exten => s-CONGESTION,1,Goto(jumping-priority,${global_did},1)
exten => s-CANCEL,1,Hangup
exten => s-CHANUNAVAIL,1,Goto(jumping-priority,${global_did},1)
;exten => s-CHANUNAVAIL,1,Goto(extvmmain,${result1},1)
exten => finish_extension,1,Hangup
exten => h,1,ExecIf($[${lc_id} != ""]?Set(WP_LC_END(`id`)=${lc_id}))
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 2)})
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 3)})
exten => h,n,NoOp()

[position-gosub]
exten => s,1,Set(LOCAL(count)=${QUEUE_WAITING_COUNT(${ARG2})})
exten => s,n,While($[${count} >= 1])
exten => s,n,Set(LOCAL(queuechannel)=${QUEUE_GET_CHANNEL(${ARG2},${count})})
exten => s,n,Set(LOCAL(channelpriority)=${IMPORT(${queuechannel},priority)})
exten => s,n,Gotoif($[${channelpriority}<=${ARG1}]?:notequal)
exten => s,n,ExitWhile()
exten => s,n(notequal),Set(LOCAL(count)=${MATH(${count}-1,int)})
exten => s,n,EndWhile()
exten => s,n,return(${MATH(${count}+1,int)})

[OutBond-Calls]
exten => _X.,1,Set(tempo=${CUT(CHANNEL,/,2)})
exten => _X.,n,Set(CDR(userfield)=${CHANNEL(recvip)})
exten => _X.,n,ExecIf($[${EXTEN:0:2} = 44]?goto(exit))
exten => _X.,n,Set(extension=${CUT(tempo,-,1)})
exten => _X.,n(continue),Set(iduser=${GENERIC_WORX(SELECT `user_id` FROM `cc_sip_buddies` WHERE `name`= ${extension})})
exten => _X.,n,Set(CDR(user_id)=${iduser})
exten => _X.,n,Set(CDR(call_type)=0)
exten => _X.,n,Set(out_cli=${GENERIC_WORX(SELECT `callerid` FROM `cc_sip_buddies` WHERE `name`= ${extension})})
exten => _X.,n,Set(destination=${GENERIC_WORX(select queue_name from cc_queue_member_table where membername=${extension})})
exten => _X.,n,Set(CDR(dest_name)=${destination})
exten => _X.,n,Set(agentName=${GENERIC_WORX(SELECT `agent_name` FROM `cc_sip_buddies` WHERE `name`= ${extension})})
exten => _X.,n,Set(callstatus=Outbound)
exten => _X.,n,Set(dialnum=${EXTEN})
exten => _X.,n,Set(CALLERID(num)=${out_cli})
exten => _X.,n,Set(CDR(extension)=${extension})
exten => _X.,n,GoSub(peerGet,1(${EXTEN}))
exten => _X.,n,NoOp(sip trunk :: ${trunk})
exten => _X.,n,NoOp(sip trunk :: ${IDTTECHROUT})
exten => _X.,n,Set(MONITOR_FILENAME=IN-${UNIQUEID}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)})
exten => _X.,n,MixMonitor(${MONITOR_FILENAME}.wav,bi(mixmvar))
exten => _X.,n,Set(CDR(DID)=${CALLERID(dnid)})
exten => _X.,n,Set(CDR(Recordings)=${MONITOR_FILENAME}.wav)
;exten => _X.,n,Mixmonitor(${UNIQUEID}.wav,b)
exten => _X.,n,GoSub(live_call,1)
exten => _X.,n,Dial(SIP/${trunk}/${EXTEN},60,tTH,,,U(outbond_ans,${UNIQUEID}^${extension}))
;exten => _X.,n,Dial(SIP/${trunk}/888889${EXTEN},60,tTH,,,U(outbond_ans,${UNIQUEID}^${extension}))
;exten => _X.,n,Dial(sip/${EXTEN}@${IDTTECHROUT},60,U(outbond_ans,${UNIQUEID}^${extension}))
exten => _X.,n,NoOp(dialstatus :: ${DIALSTATUS})
exten => _X.,n,StopMixMonitor(${mixmvar})
exten => _X.,n(exit),Hangup
exten => peerGet,1,Set(dialnum=${ARG1})
exten => peerGet,n,Set(prefix2=${dialnum:0:2})
exten => peerGet,n,Set(prefix3=${dialnum:0:3})
exten => peerGet,n,Set(prefix1=${dialnum:0:1})
exten => peerGet,n,Set(prefix4=${dialnum:0:4})
exten => peerGet,n,ExecIf($["${prefix3}": "91"]?Set(trunk=sbc.pstncall.com))
exten => peerGet,n,ExecIf($["${prefix1}": "1"]?Set(trunk=sbc.pstncall.com))
exten => peerGet,n,Return()

exten => IDTTECHROUT,1,Set(dialnum=${ARG1})
exten => IDTTECHROUT,n,Set(prefix1=${dialnum:0:1})
exten => IDTTECHROUT,n,Set(prefix2=${dialnum:0:2})
exten => IDTTECHROUT,n,Set(prefix3=${dialnum:0:3}
exten => IDTTECHROUT,n,Return()

exten => live_call,1,Set(WP_LC_BEGIN(${iduser},${UNIQUEID},${dialnum},${extension},${destination},${callstatus},2,${dialnum},${CHANNEL})=)
exten => live_call,n,Set(__lc_id=${WP_LC_BEGIN(${iduser},${UNIQUEID},${dialnum},${dialnum},${destination},${callstatus},2,${dialnum},${CHANNEL})})
exten => live_call,n,Return

exten => h,1,ExecIf($[${lc_id} != ""]?Set(WP_LC_END(`id`)=${lc_id}))
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 2)})
exten => h,n,NoOp()


[Internal-Call-Trasfer]
exten => _X.,1(binternal),NoOP()
exten => _X.,n,Set(tempo=${CUT(CHANNEL,/,2)})
exten => _X.,n,Set(extension=${CUT(tempo,-,1)})
exten => _X.,n,Set(iduser=${GENERIC_WORX(SELECT `id_cc_card` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,Set(CDR(user_id)=${iduser})
exten => _X.,n,Set(destination=${GENERIC_WORX(select queue_name from cc_queue_member_table where membername=${result1})})
exten => _X.,n,Set(CDR(dest_name)=${destination})
exten => _X.,n,Set(agentName=${GENERIC_WORX(SELECT `agent_name` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,Set(CDR(call_type)=0)
exten => _X.,n,Set(out_cli=${GENERIC_WORX(SELECT `callerid` FROM `cc_sip_buddies` WHERE `name`= ${result1})}))
exten => _X.,n,Set(dial_out=${GENERIC_WORX(SELECT `dial_timeout` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,Set(callstatus=Inbound)
;exten => _X.,n,Set(dialnum=${global_did})
exten => _X.,n,Set(dialnum=${result1})
exten => _X.,n,Set(CALLERID(num)=${global_clin})
exten => _X.,n,Set(CDR(Recordings)=${UNIQUEID}.wav)
exten => _X.,n,Set(CDR(extension)=${extension})
exten => _X.,n,Set(MONITOR_FILENAME=IN-${UNIQUEID}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)})
exten => _X.,n,MixMonitor(${MONITOR_FILENAME}.wav,bi(mixmvar))
exten => _X.,n,Set(CDR(DID)=${CALLERID(dnid)})
exten => _X.,n,Set(CDR(Recordings)=${MONITOR_FILENAME}.wav)
exten => _X.,n,Set(ext_status=${GENERIC_WORX(SELECT `paused` FROM `cc_queue_member_table` WHERE `queue_name` =${destination} AND `membername` = ${result1})})
exten => _X.,n(action),GotoIf($["${ext_status}" = "1"]?exit:)
exten => _X.,n,GoSub(exten-ivr,s,1)
exten => _X.,n,GoSub(live_call,1)
exten => _X.,n,Dial(SIP/${dialnum},${dial_out},U(internal_call_transfer,${UNIQUEID}^${result1}))
;exten => _X.,n,Dial(${result1},${dial_out},U(ext_ans,${UNIQUEID}^${result1}))
exten => _X.,n,StopMixMonitor(${mixmvar})
exten => _X.,n,NoOp(Dial Status:: ${DIALSTATUS})
exten => _X.,n,Goto(s-${DIALSTATUS},1)
exten => _X.,n,Set(extenfail=${GENERIC_WORX(SELECT `fail_status` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${extenfail}" = "Y"]?:finish_extension)
exten => _X.,n,Verbose( call is terminated)
exten => _X.,n,Set(__result=${GENERIC_WORX(SELECT `fail_dest` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${result}" = ""]?finish_extension)
exten => _X.,n,Set(__result1=${GENERIC_WORX(SELECT `fail_data` FROM `cc_sip_buddies` WHERE `name`= ${result1})})
exten => _X.,n,GotoIf($["${result1}" = ""]?exit:jumping-priority,${global_did},1)
exten => _X.,n(exit),1,Hangup
exten => live_call,1,Set(WP_LC_BEGIN(${iduser},${UNIQUEID},${dialnum},${out_cli},${destination},${callstatus},2,${dialnum},${CHANNEL})=)
exten => live_call,n,Set(__lc_id=${WP_LC_BEGIN(${iduser},${UNIQUEID},${dialnum},${dialnum},${destination},${callstatus},2,${dialnum},${CHANNEL})})
exten => live_call,n,Return
exten => s-NOANSWER,1,Goto(jumping-priority,${global_did},1)
;exten => s-NOANSWER,1,Goto(extvmmain,${result1},1)
exten => s-BUSY,1,Goto(jumping-priority,${global_did},1)
;exten => s-BUSY,1,Goto(extvmmain,${result1},1)
exten => s-ANSWER,1,Goto(finish_extension)
exten => s-CONGESTION,1,Goto(jumping-priority,${global_did},1)
exten => s-CANCEL,1,Hangup
exten => s-CHANUNAVAIL,1,Goto(jumping-priority,${global_did},1)
;exten => s-CHANUNAVAIL,1,Goto(extvmmain,${result1},1)
exten => finish_extension,1,Hangup
exten => h,1,ExecIf($[${lc_id} != ""]?Set(WP_LC_END(`id`)=${lc_id}))
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 2)})
exten => h,n,NoOp()

[extensions-to-extensions]
exten => _X.,1,Progress()
exten => _X.,n,Set(tempo=${CUT(CHANNEL,/,2)})
exten => _X.,n,Set(extension=${CUT(tempo,-,1)})
exten => _X.,n,Set(iduser=${GENERIC_WORX(SELECT `id_cc_card` FROM `cc_sip_buddies` WHERE `name`= ${extension})})
exten => _X.,n,Set(CDR(user_id)=${iduser})
exten => _X.,n,Set(destination=${GENERIC_WORX(select queue_name from cc_queue_member_table where membername=${extension})})
exten => _X.,n,Set(CDR(dest_name)=${destination})
exten => _X.,n,Set(agentName=${GENERIC_WORX(SELECT `agent_name` FROM `cc_sip_buddies` WHERE `name`= ${extension})})
exten => _X.,n,Set(CDR(call_type)=0)
exten => _X.,n,Set(out_cli=${GENERIC_WORX(SELECT `callerid` FROM `cc_sip_buddies` WHERE `name`= ${extension})})
exten => _X.,n,Set(destination=${GENERIC_WORX(select queue_name from cc_queue_member_table where membername=${extension})})
exten => _X.,n,Set(CDR(dest_name)=${destination})
exten => _X.,n,Set(agentName=${GENERIC_WORX(SELECT `agent_name` FROM `cc_sip_buddies` WHERE `name`= ${extension})})
exten => _X.,n,Set(dial_out=${GENERIC_WORX(SELECT `dial_timeout` FROM `cc_sip_buddies` WHERE `name`= ${extension})})
exten => _X.,n,Set(callstatus=Internal-Call)
exten => _X.,n,Set(dialnum=${EXTEN})
exten => _X.,n,Set(CALLERID(num)=${out_cli})
exten => _X.,n,Set(CDR(Recordings)=${UNIQUEID}.wav)
exten => _X.,n,Set(CDR(extension)=${extension})
exten => _X.,n,Mixmonitor(${UNIQUEID}.wav,b)
exten => _X.,n,Set(ext_status=${GENERIC_WORX(SELECT `paused` FROM `cc_queue_member_table` WHERE `queue_name` =${destination} AND `membername` = ${extension})})
exten => _X.,n,GotoIf($[${ext_status}" = 1]?dial-${ext_status},1)
exten => _X.,n,GoSub(live_call,1)
exten => _X.,n,AGI(SSagi/worxdialer.php,4)
exten => _X.,n,playback(goodbye)
exten => live_call,1,Set(WP_LC_BEGIN(${iduser},${UNIQUEID},${dialnum},${out_cli},${destination},${callstatus},2,${extension},${CHANNEL})=)
exten => live_call,n,Set(__lc_id=${WP_LC_BEGIN(${iduser},${UNIQUEID},${dialnum},${dialnum},${destination},${callstatus},2,${extension},${CHANNEL})})
exten => live_call,n,GoSub(Extensions_Inbound,s,1)
exten => live_call,n,Return()
exten => dial-1,1,NoOP("Hello Wait A Sec Mr. ${agentName}, We Found the Status of Extension No. ${extension} is OFF Please make it On To start the dialing")
exten => dial-1,n,Agi(SSagi/googletts.agi,"Hello Dear ${agentName}, We Found Your Extension, ${extension}! is OFF, Please Ask To I T Team To make it enable To start the calling, Thank you!",en);
exten => dial-1,n,Hangup()
exten => h,1,ExecIf($[${lc_id} != ""]?Set(WP_LC_END(`id`)=${lc_id}))
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 2)})
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 3)})
exten => h,n,NoOp()

exten => _*.,1,Set(__result1=${EXTEN:1})
exten => _*.,n,Goto(Internal-Call-Trasfer,${result1},binternal)
exten => _*.,n,Hangup



[ext_ans]
exten => s,1,Set(DB(snva/cust_ansepoch_${ARG1})=${EPOCH})
exten => s,n,Set(cut_agent=${ARG2})
exten => s,n,Set(agent_name=)
exten => s,n,Set(WP_LC_ANS(`agent_number`,`agent_name`,`call_status`,`id`,`status`,`modified`)=${cut_agent},${agent_name},Inbound(connected),${lc_id},3)
exten => s,n,Return()

[Internal-Call-Trasfer]
exten => s,1,Set(DB(snva/cust_ansepoch_${ARG1})=${EPOCH})
exten => s,n,Set(cut_agent=${ARG2})
exten => s,n,Set(agent_name=)
exten => s,n,Set(WP_LC_ANS(`agent_number`,`agent_name`,`call_status`,`id`,`status`,`modified`)=${cut_agent},${agent_name},Internal-Call-Trasfer(connected),${lc_id},3)
exten => s,n,Return()




[transfer_ans]
exten => s,1,Set(DB(snva/cust_ansepoch_${ARG1})=${EPOCH})
exten => s,n,Set(cut_agent=${ARG2})
exten => s,n,Set(agent_name=)
exten => s,n,Set(WP_LC_ANS(`agent_number`,`agent_name`,`call_status`,`id`,`status`,`modified`)=${cut_agent},${agent_name},Call-Transfer(connected),${lc_id},3)
exten => s,n,Return()


[outbond_ans]
exten => s,1,Set(DB(snva/cust_ansepoch_${ARG1})=${EPOCH})
exten => s,n,Set(cut_agent=${ARG2})
exten => s,n,Set(agent_name=)
exten => s,n,Set(WP_LC_ANS(`agent_number`,`agent_name`,`call_status`,`id`,`status`,`modified`)=${cut_agent},${agent_name},Outbond(connected),${lc_id},3)
exten => s,n,Return()



[Cellular_Outbond]
exten => s,1,Set(cut_channel=${CUT(CHANNEL,/,2)})
exten => s,n,Set(cut_agent=${CUT(cut_channel,-,1)})
exten => s,n,Set(CDR(extension)=${cut_agent})
;exten => s,n,playback(prepaid-callback_intro)
exten => s,n,Set(agent_name=${GENERIC_WORX(select agent_name from cc_sip_buddies where name = ${cut_agent})})
exten => s,n,Set(DB(w2c_ext/${lc_id})=${cut_agent})
exten => s,n,Set(DB(w2c_ext_name/${lc_id})=${agent_name})
exten => s,n,Set(WP_LC_ANS(`agent_number`,`agent_name`,`call_status`,`id`,`status`,`modified`)=${cut_agent},${agent_name},Outbound(connected),${lc_id},3)
exten => s,n,Return()

[play_callback_msg]
exten => s,1,Set(cut_channel=${CUT(CHANNEL,/,2)})
exten => s,n,Set(cut_agent=${CUT(cut_channel,-,1)})
exten => s,n,Set(CDR(extension)=${cut_agent})
exten => s,n,Set(agent_name=${GENERIC_WORX(select exten from cc_callback_request where name = ${cut_agent})})
exten => s,n,Set(DB(w2c_ext/${lc_id})=${cut_agent})
exten => s,n,Set(DB(w2c_ext_name/${lc_id})=${agent_name})
exten => s,n,Set(WP_LC_ANS(`agent_number`,`agent_name`,`call_status`,`id`,`status`,`modified`)=${cut_agent},${agent_name},Outbound(connected),${lc_id},3)
exten => s,n,Agi(SSagi/googletts.agi,"This is your callback request with us",en);
exten => s,n,Return()

[Extensions_Inbound]
exten => s,1,Set(cut_channel=${CUT(CHANNEL,/,2)})
exten => s,n,Set(cut_agent=${CUT(cut_channel,-,1)})
exten => s,n,Set(CDR(extension)=${cut_agent})
exten => s,n,Set(agent_name=${GENERIC_WORX(select agent_name from cc_sip_buddies where name = ${cut_agent})})
exten => s,n,Set(DB(w2c_ext/${lc_id})=${cut_agent})
exten => s,n,Set(DB(w2c_ext_name/${lc_id})=${agent_name})
exten => s,n,Set(WP_LC_ANS(`agent_number`,`agent_name`,`call_status`,`id`,`status`,`modified`)=${cut_agent},${agent_name},Internal-Call(connected),${lc_id},3)
exten => s,n,Return()



[Callbackqueue-Context]
exten => _X.,1,Progress()
exten => _X.,n,Set(tempo=${CUT(CHANNEL,/,2)})
exten => _X.,n,Set(EXTEN=${CUT(tempo,-,1)})
exten => _X.,n,Playback(AgentIVR)
exten => _X.,n,Agi(callback_msg.php,${PHONESTATUS});
exten => _X.,n,Agi(googletts.agi,"The issue reported by customer is,! ${MESSAGE}",en);
exten => _X.,n,Agi(cc_dialnumber.php,${CALLNO}
exten => _X.,n,NoOP(${CBID})
exten => _X.,n,Set(__RR=${GENERIC_WORX(SELECT `report` FROM `cc_callback_request` WHERE `id`= ${CBID})})
exten => _X.,n,Set(__out_cli=${GENERIC_WORX(SELECT `channel` FROM `cc_callback_request` WHERE `id`= ${CBID})})
exten => _X.,n,Set(__dialnum=${GENERIC_WORX(SELECT `exten` FROM `cc_callback_request` WHERE `id`= ${CBID})})
exten => _X.,n,Set(__myid=${GENERIC_WORX(SELECT `id` FROM `cc_callback_request` WHERE `id`= ${CBID})})
exten => _X.,n,Set(callstatus=Callback)
exten => _X.,n,Set(CALLERID(num)=${out_cli})
exten => _X.,n,Set(CDR(call_type)=2)
exten => _X.,n,Set(CDR(Recordings)=${UNIQUEID}.wav)
exten => _X.,n,GoSub(update_call,1)
exten => _X.,n,AGI(bigpbx.php,3)
exten => update_call,1,Set(${GENERIC_WORX(UPDATE cc_callback_request SET call_id=3 WHERE status=1 and id =${CBID} LIMIT 1)})
exten => update_call,n,Return()
exten => _X.,n,Hangup
exten => h,1,MySQL(Connect connid localhost root tumko34h1se worxdialer)
exten => h,n,MYSQL(Query resultid ${connid} UPDATE cc_callback_request SET status=0 WHERE call_id=3 LIMIT 1)
exten => h,n,MYSQL(Clear ${resultid})
exten => h,n,MYSQL(Query resultid ${connid} UPDATE cc_callback_request SET call_id=1 WHERE call_id=3 LIMIT 1)
exten => h,n,MYSQL(Clear ${resultid})
exten => h,n,NoOp()

[Callback-Queue]
exten => _X.,1,Progress()
exten => _X.,n,Set(__blacklist=${GENERIC_WORX(SELECT exten FROM cc_callback_request WHERE STATUS=1 AND channel=${EXTEN})})
exten => _X.,n,NoOP(${blacklist})
exten => _X.,n,MYSQL(Connect connid localhost root tumko34h1se worxdialer)
exten => _X.,n,MYSQL(Query r ${connid} SELECT callbacknum FROM callback_blacklist WHERE callbacknum=${blacklist})
exten => _X.,n,MYSQL(Fetch f ${r} EXTEN)
exten => _X.,n,GotoIf($["${f}"="1"]?exit:GoodNum)
exten => _X.,n(GoodNum),Dial(SIP/NET2-CALL/${EXTEN},180,tTHL)
;exten => _X.,n(GoodNum),Dial(SIP/sbc.pstncall.com/${EXTEN},,tTHL)
;exten => _X.,n(GoodNum),AGI(SSagi/bigpbx.php,3)
exten => _X.,n,Hangup
exten => _X.,n(exit),Hangup

[SSCall]
exten => _X.,1,Progress()
exten => _X.,n,Set(dialnum=${EXTEN})
exten => _X.,n,Set(extension=${dialnum})
exten => _X.,n,Set(out_cli=448882000011)
exten => _X.,n,Set(CALLERID(num)=${out_cli})
exten => _X.,n,Mixmonitor(${UNIQUEID}.wav,b)
exten => _X.,n,Set(CDR(Recordings)=${UNIQUEID}.wav)
exten => _X.,n,GoSub(live_call,1)
exten => _X.,n,Dial(SIP/Schedule-Calling/0${EXTEN:2},60,TtHU(wild_card_ans,${UNIQUEID}^${extension}))
exten => _X.,n,StopMixMonitor(${mixmvar})
exten => _X.,n,NoOp(dialstatus :: ${DIALSTATUS})
exten => _X.,n,Goto(s-${DIALSTATUS},1)
exten => _X.,n,Hangup()
exten => live_call,1,Set(WP_LC_BEGIN(${iduser},${UNIQUEID},${dialnum},${out_cli},${destination},${callstatus},2,${extension},${CHANNEL})=)
exten => live_call,n,Set(__lc_id=${WP_LC_BEGIN(${iduser},${UNIQUEID},${dialnum},${dialnum},${destination},${callstatus},2,${extension},${CHANNEL})})
exten => live_call,n,Return()
exten => s-NOANSWER,1,Goto(finish_extension)
exten => s-BUSY,1,playback(all-circuits-busy-now&goodbye)
exten => s-BUSY,n,Hangup
exten => s-ANSWER,1,Goto(finish_extension)
exten => s-CONGESTION,1,playback(all-circuits-busy-now&goodbye)
exten => s-CONGESTION,n,Hangup
exten => s-CANCEL,1,Hangup
exten => s-CHANUNAVAIL,1,playback(all-circuits-busy-now&goodbye)
exten => s-CHANUNAVAIL,n,Hangup
exten => finish_extension,1,Hangup
exten => h,1,ExecIf($[${lc_id} != ""]?Set(WP_LC_END(`id`)=${lc_id}))
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 1)})
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 2)})
exten => h,n,ExecIf(${GENERIC_WORX(DELETE FROM `cc_live_calls` WHERE  call_id = ${UNIQUEID} AND status = 3)})

[Scheduling-Call]
exten => _X.,1,Answer()
exten => _X.,n,Set(__channel=${EXTEN})
exten => _X.,n,Set(__STATUS=1)
exten => _X.,n,Set(__TEXT=${GENERIC_WORX(SELECT `voiceCallText` FROM `callque` WHERE `status` =${STATUS} AND `channel` = ${channel})})
exten => _X.,n,Set(__ID=${GENERIC_WORX(SELECT `uniqueid` FROM `callque` WHERE `status` =${STATUS} AND `channel` = ${channel})})
exten => _X.,n,Set(__escalation_id=${GENERIC_WORX(SELECT `escalation_id` FROM `callque` WHERE `status` =${STATUS} AND `channel` = ${channel})})
exten => _X.,n,Set(__siteID=${GENERIC_WORX(SELECT `siteID` FROM `callque` WHERE `status` =${STATUS} AND `channel` = ${channel})})
exten => _X.,n,Set(__MSDPCustomerID=${GENERIC_WORX(SELECT `MSDPCustomerID` FROM `callque` WHERE `status` =${STATUS} AND `channel` = ${channel})})
exten => _X.,n,Set(__workOrderDueDate=${GENERIC_WORX(SELECT `workOrderDueDate` FROM `callque` WHERE `status` =${STATUS} AND `channel` = ${channel})})
exten => _X.,n,agi(googletts.agi,"Dear ${TEXT} ${siteID}. Your escalation id, ${escalation_id}. AND MSDPCustomerID, ${MSDPCustomerID}. Visit on urgent basis , thank You.",en)
exten => h,1,NoOp(${channel}::${ID=})
exten => h,n,MySQL(Connect connid localhost root tumko34h1se bigdialer)
exten => h,n,MYSQL(Query resultid ${connid} UPDATE callque SET status=0 WHERE channel =${channel} AND uniqueid=${ID})
exten => s,n,MySQL(Fetch fetchid ${resultid} channel)
exten => h,n,MYSQL(Clear ${resultid})
exten => h,n,MYSQL(Disconnect ${connid})


